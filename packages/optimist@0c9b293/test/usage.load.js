montageDefine("0c9b293","test/usage",{dependencies:["hashish","../index","tap"],factory:function(e,o,s){function r(e){var o=!1;process._exit=process.exit,process._env=process.env,process._argv=process.argv,process.exit=function(e){o=!0},process.env=a.merge(process.env,{_:"node"}),process.argv=["./usage"];var s=[],r=[];console._error=console.error,console.error=function(e){s.push(e)},console._log=console.log,console.log=function(e){r.push(e)};var n=e();return process.exit=process._exit,process.env=process._env,process.argv=process._argv,console.error=console._error,console.log=console._log,{errors:s,logs:r,exit:o,result:n}}var a=e("hashish"),n=e("../index"),t=e("tap").test;t("usageFail",function(e){var o=r(function(){return n("-x 10 -z 20".split(" ")).usage("Usage: $0 -x NUM -y NUM").demand(["x","y"]).argv});e.same(o.result,{x:10,z:20,_:[],$0:"./usage"}),e.same(o.errors.join("\n").split(/\n+/),["Usage: ./usage -x NUM -y NUM","Options:","  -x  [required]","  -y  [required]","Missing required arguments: y"]),e.same(o.logs,[]),e.ok(o.exit),e.end()}),t("usagePass",function(e){var o=r(function(){return n("-x 10 -y 20".split(" ")).usage("Usage: $0 -x NUM -y NUM").demand(["x","y"]).argv});e.same(o,{result:{x:10,y:20,_:[],$0:"./usage"},errors:[],logs:[],exit:!1}),e.end()}),t("checkPass",function(e){var o=r(function(){return n("-x 10 -y 20".split(" ")).usage("Usage: $0 -x NUM -y NUM").check(function(e){if(!("x"in e))throw"You forgot about -x";if(!("y"in e))throw"You forgot about -y"}).argv});e.same(o,{result:{x:10,y:20,_:[],$0:"./usage"},errors:[],logs:[],exit:!1}),e.end()}),t("checkFail",function(e){var o=r(function(){return n("-x 10 -z 20".split(" ")).usage("Usage: $0 -x NUM -y NUM").check(function(e){if(!("x"in e))throw"You forgot about -x";if(!("y"in e))throw"You forgot about -y"}).argv});e.same(o.result,{x:10,z:20,_:[],$0:"./usage"}),e.same(o.errors.join("\n").split(/\n+/),["Usage: ./usage -x NUM -y NUM","You forgot about -y"]),e.same(o.logs,[]),e.ok(o.exit),e.end()}),t("checkCondPass",function(e){function o(e){return"x"in e&&"y"in e}var s=r(function(){return n("-x 10 -y 20".split(" ")).usage("Usage: $0 -x NUM -y NUM").check(o).argv});e.same(s,{result:{x:10,y:20,_:[],$0:"./usage"},errors:[],logs:[],exit:!1}),e.end()}),t("checkCondFail",function(e){function o(e){return"x"in e&&"y"in e}var s=r(function(){return n("-x 10 -z 20".split(" ")).usage("Usage: $0 -x NUM -y NUM").check(o).argv});e.same(s.result,{x:10,z:20,_:[],$0:"./usage"}),e.same(s.errors.join("\n").split(/\n+/).join("\n"),"Usage: ./usage -x NUM -y NUM\nArgument check failed: "+o.toString()),e.same(s.logs,[]),e.ok(s.exit),e.end()}),t("countPass",function(e){var o=r(function(){return n("1 2 3 --moo".split(" ")).usage("Usage: $0 [x] [y] [z] {OPTIONS}").demand(3).argv});e.same(o,{result:{_:["1","2","3"],moo:!0,$0:"./usage"},errors:[],logs:[],exit:!1}),e.end()}),t("countFail",function(e){var o=r(function(){return n("1 2 --moo".split(" ")).usage("Usage: $0 [x] [y] [z] {OPTIONS}").demand(3).argv});e.same(o.result,{_:["1","2"],moo:!0,$0:"./usage"}),e.same(o.errors.join("\n").split(/\n+/),["Usage: ./usage [x] [y] [z] {OPTIONS}","Not enough non-option arguments: got 2, need at least 3"]),e.same(o.logs,[]),e.ok(o.exit),e.end()}),t("defaultSingles",function(e){var o=r(function(){return n("--foo 50 --baz 70 --powsy".split(" "))["default"]("foo",5)["default"]("bar",6)["default"]("baz",7).argv});e.same(o.result,{foo:"50",bar:6,baz:"70",powsy:!0,_:[],$0:"./usage"}),e.end()}),t("defaultAliases",function(e){var o=r(function(){return n("").alias("f","foo")["default"]("f",5).argv});e.same(o.result,{f:"5",foo:"5",_:[],$0:"./usage"}),e.end()}),t("defaultHash",function(e){var o=r(function(){return n("--foo 50 --baz 70".split(" "))["default"]({foo:10,bar:20,quux:30}).argv});e.same(o.result,{_:[],$0:"./usage",foo:50,baz:70,bar:20,quux:30}),e.end()}),t("rebase",function(e){e.equal(n.rebase("/home/substack","/home/substack/foo/bar/baz"),"./foo/bar/baz"),e.equal(n.rebase("/home/substack/foo/bar/baz","/home/substack"),"../../.."),e.equal(n.rebase("/home/substack/foo","/home/substack/pow/zoom.txt"),"../pow/zoom.txt"),e.end()})}});