montageDefine("c9483d2","dom/level2/events",{dependencies:["./core","../utils"],factory:function(t,e,n){function i(t){return t.nodeType==a.Node.DOCUMENT_NODE?t:t._ownerDocument}function r(t){return t.nodeType!=a.Node.ATTRIBUTE_NODE&&i(t).implementation.hasFeature("MutationEvents")}function o(t){return function(e,n,i){var o=this._parentNode,a=e.apply(this,n);if(r(o)){var s,l=o._ownerDocument,c=u.MutationEvent.prototype[t],h=a&&a.name||i.name,v=a&&a.value||null,p="ADDITION"==t?i.value:null;p&&p==v||(s=l.createEvent("MutationEvents"),s.initMutationEvent("DOMAttrModified",!0,!1,o,v,p,h,c),o.dispatchEvent(s))}return a}}var a=t("./core").dom.level2.core,s=t("../utils");a=Object.create(a);var u={};u.EventException=function(){arguments.length>0?this._code=arguments[0]:this._code=0,arguments.length>1?this._message=arguments[1]:this._message="Unspecified event type",Error.call(this,this._message),Error.captureStackTrace&&Error.captureStackTrace(this,u.EventException)},u.EventException.prototype={UNSPECIFIED_EVENT_TYPE_ERR:0,get code(){return this._code}},u.EventException.prototype.__proto__=Error.prototype,u.Event=function(t){this._eventType=t,this._type=null,this._bubbles=null,this._cancelable=null,this._target=null,this._currentTarget=null,this._eventPhase=null,this._timeStamp=null,this._preventDefault=!1,this._stopPropagation=!1},u.Event.prototype={initEvent:function(t,e,n){this._type=t,this._bubbles=e,this._cancelable=n},preventDefault:function(){this._cancelable&&(this._preventDefault=!0)},stopPropagation:function(){this._stopPropagation=!0},CAPTURING_PHASE:1,AT_TARGET:2,BUBBLING_PHASE:3,get eventType(){return this._eventType},get type(){return this._type},get bubbles(){return this._bubbles},get cancelable(){return this._cancelable},get target(){return this._target},get currentTarget(){return this._currentTarget},get eventPhase(){return this._eventPhase},get timeStamp(){return this._timeStamp}},u.UIEvent=function(t){u.Event.call(this,t),this.view=null,this.detail=null},u.UIEvent.prototype={initUIEvent:function(t,e,n,i,r){this.initEvent(t,e,n),this.view=i,this.detail=r}},u.UIEvent.prototype.__proto__=u.Event.prototype,u.MouseEvent=function(t){u.UIEvent.call(this,t),this.screenX=null,this.screenY=null,this.clientX=null,this.clientY=null,this.ctrlKey=null,this.shiftKey=null,this.altKey=null,this.metaKey=null,this.button=null,this.relatedTarget=null},u.MouseEvent.prototype={initMouseEvent:function(t,e,n,i,r,o,a,s,u,l,c,h,v,p,E){this.initUIEvent(t,e,n,i,r),this.screenX=o,this.screenY=a,this.clientX=s,this.clientY=u,this.ctrlKey=l,this.shiftKey=h,this.altKey=c,this.metaKey=v,this.button=p,this.relatedTarget=E}},u.MouseEvent.prototype.__proto__=u.UIEvent.prototype,u.MutationEvent=function(t){u.Event.call(this,t),this.relatedNode=null,this.prevValue=null,this.newValue=null,this.attrName=null,this.attrChange=null},u.MutationEvent.prototype={initMutationEvent:function(t,e,n,i,r,o,a,s){this.initEvent(t,e,n),this.relatedNode=i,this.prevValue=r,this.newValue=o,this.attrName=a,this.attrChange=s},MODIFICATION:1,ADDITION:2,REMOVAL:3},u.MutationEvent.prototype.__proto__=u.Event.prototype,u.EventTarget=function(){},u.EventTarget.getListeners=function(t,e,n){var i=t._listeners&&t._listeners[e]&&t._listeners[e][n]||[];if(!n){var r=t["on"+e];if(r){var o=t._ownerDocument?t._ownerDocument.implementation:t.document.implementation;o.hasFeature("ProcessExternalResources","script")&&i.push(r)}}return i},u.EventTarget.dispatch=function(t,e,n){for(var i,r,o=e();o&&!t._stopPropagation;){for(i=u.EventTarget.getListeners(o,t._type,n),r=i.length;r--;){t._currentTarget=o;try{i[r].call(o,t)}catch(a){o.raise("error","Dispatching event '"+t._type+"' failed",{error:a,event:t})}}o=e()}return!t._stopPropagation},u.EventTarget.forwardIterator=function(t){var e=0,n=t.length;return function(){return e<n?t[e++]:null}},u.EventTarget.backwardIterator=function(t){var e=t.length;return function(){return e>=0?t[--e]:null}},u.EventTarget.singleIterator=function(t){var e=1;return function(){return e--?t:null}},u.EventTarget.prototype={addEventListener:function(t,e,n){this._listeners=this._listeners||{};var i=this._listeners[t]||{};n=n===!0;for(var r=i[n]||[],o=0;o<r.length;o++)if(r[o]===e)return;r.push(e),i[n]=r,this._listeners[t]=i},removeEventListener:function(t,e,n){var i=this._listeners&&this._listeners[t];if(i){var r=i[n===!0];if(r)for(var o=0;o<r.length;o++)if(r[o]===e)return void r.splice(o,1)}},dispatchEvent:function(t){if(null==t)throw new u.EventException(0,"Null event");if(null==t._type||""==t._type)throw new u.EventException(0,"Uninitialized event");var e=[];t._target=this;for(var n=this,i=n._parentNode;i;)e.push(i),n=i,i=n._parentNode;i=n._parentWindow,i&&e.push(i);var r=u.EventTarget.backwardIterator(e);if(t._eventPhase=t.CAPTURING_PHASE,!u.EventTarget.dispatch(t,r,!0))return t._preventDefault;if(r=u.EventTarget.singleIterator(t._target),t._eventPhase=t.AT_TARGET,!u.EventTarget.dispatch(t,r,!1))return t._preventDefault;if(t._bubbles&&!t._stopPropagation){r=u.EventTarget.forwardIterator(e),t._eventPhase=t.BUBBLING_PHASE,u.EventTarget.dispatch(t,r,!1)}return t._preventDefault}},a.Node.prototype.__proto__=u.EventTarget.prototype,s.intercept(a.Node,"insertBefore",function(t,e,n,o){var s=t.apply(this,e);if(r(this)){var u=i(this),l=u.createEvent("MutationEvents");l.initMutationEvent("DOMNodeInserted",!0,!1,this,null,null,null,null),n.dispatchEvent(l),(this.nodeType==a.Node.DOCUMENT_NODE||this._attachedToDocument)&&(l=u.createEvent("MutationEvents"),l.initMutationEvent("DOMNodeInsertedIntoDocument",!1,!1,null,null,null,null,null),a.visitTree(n,function(t){t.nodeType==a.Node.ELEMENT_NODE&&(t.dispatchEvent(l),t._attachedToDocument=!0)}))}return s}),s.intercept(a.Node,"removeChild",function(t,e,n){if(r(this)){var o=i(this),s=o.createEvent("MutationEvents");s.initMutationEvent("DOMNodeRemoved",!0,!1,this,null,null,null,null),n.dispatchEvent(s),s=o.createEvent("MutationEvents"),s.initMutationEvent("DOMNodeRemovedFromDocument",!1,!1,null,null,null,null,null),a.visitTree(n,function(t){t.nodeType==a.Node.ELEMENT_NODE&&(t.dispatchEvent(s),t._attachedToDocument=!1)})}return t.apply(this,e)}),s.intercept(a.AttrNodeMap,"removeNamedItem",o("REMOVAL")),s.intercept(a.AttrNodeMap,"setNamedItem",o("ADDITION")),a.CharacterData.prototype.__defineGetter__("_nodeValue",function(){return this.__nodeValue}),a.CharacterData.prototype.__defineSetter__("_nodeValue",function(t){var e=this.__nodeValue;if(this.__nodeValue=t,this._ownerDocument&&this._parentNode&&r(this)){var n=this._ownerDocument.createEvent("MutationEvents");n.initMutationEvent("DOMCharacterDataModified",!0,!1,this,e,t,null,null),this.dispatchEvent(n)}}),a.Document.prototype.createEvent=function(t){switch(t){case"MutationEvents":return new u.MutationEvent(t);case"UIEvents":return new u.UIEvent(t);case"MouseEvents":return new u.MouseEvent(t);case"HTMLEvents":return new u.Event(t)}return new u.Event(t)},e.dom={level2:{core:a,events:u}}}});