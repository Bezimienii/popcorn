function stringifyDoctype(e){if(e.ownerDocument&&e.ownerDocument._fullDT)return e.ownerDocument._fullDT;var n="<!DOCTYPE "+e.name;return e.publicId&&(n+=' PUBLIC "'+e.publicId+'" '),!e.publicId&&e.systemId&&(n+=" SYSTEM "),e.systemId&&(n+=e.systemId.indexOf('"')>-1?"'"+e.systemId+"'":'"'+e.systemId+'"'),n+=">"}var singleTags={area:1,base:1,basefont:1,br:1,col:1,frame:1,hr:1,img:1,input:1,isindex:1,link:1,meta:1,param:1,embed:1},expr={upperCaseChars:/([A-Z])/g,breakBetweenTags:/(<(\/?\w+).*?>)(?=<(?!\/\2))/gi,singleTag:function(){var e=[];for(var n in singleTags)e.push(n);return new RegExp("<"+e.join("|<"),"i")}()},uncanon=function(e,n){return"-"+n.toLowerCase()},HTMLEncode=require("./htmlencoding").HTMLEncode;exports.stringifyElement=function(e){var n,t=e.tagName.toLowerCase(),r={start:"<"+t,end:""},a=[],o=null;if(e.attributes.length)for(r.start+=" ",n=0;n<e.attributes.length;n++)o=e.attributes.item(n),a.push(o.name+'="'+HTMLEncode(o.nodeValue,!0)+'"');return r.start+=a.join(" "),singleTags[t]?(r.start+=" />",r.end=""):(r.start+=">",r.end="</"+t+">"),r};var rawTextElements=/SCRIPT|STYLE/i;exports.makeHtmlGenerator=function(e,n){return e=e||"",n=n||"",function t(r,a,o){var s,i,d="";if(o=o||"",r){r.nodeType&&r.nodeType===r.ENTITY_REFERENCE_NODE&&(r=r._entity);var l=a||rawTextElements.test(r.nodeName);switch(r.nodeType){case r.ELEMENT_NODE:if(s=exports.stringifyElement(r),d+=l?o+s.start:o+s.start,r._childNodes.length>0){for(r._childNodes[0].nodeType!==r.TEXT_NODE&&(d+=n),i=0;i<r._childNodes.length;i++)d+=t(r._childNodes[i],l,o+e);r._childNodes[r._childNodes.length-1].nodeType!==r.TEXT_NODE&&(d+=o),d+=s.end+n}else d+=((a?r.nodeValue:HTMLEncode(r.nodeValue,!1))||"")+s.end+n;break;case r.TEXT_NODE:e&&/^[\s\n]*$/.test(r.nodeValue)||(d+=(a?r.nodeValue:HTMLEncode(r.nodeValue,!1))||"");break;case r.COMMENT_NODE:d+=o+"<!--"+r.nodeValue+"-->"+n;break;case r.DOCUMENT_NODE:for(i=0;i<r._childNodes.length;i++)d+=t(r._childNodes[i],l,o);break;case r.DOCUMENT_TYPE_NODE:d+=stringifyDoctype(r)}}return d}},exports.domToHtml=function(e,n,t){var r=exports.makeHtmlGenerator(n?"":"  ",n?"":"\n");if(e._toArray&&(e=e._toArray()),"undefined"!=typeof e.length){for(var a="",o=0,s=e.length;o<s;o++)a+=r(e[o],t);return a}return r(e,t)};