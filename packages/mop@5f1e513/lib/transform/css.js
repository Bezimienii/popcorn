function transformCss(r,e,s){r.utf8=rebaseCss(r.utf8,r,e),s&&s()}function rebaseCss(r,e,s){if(s.noCss||!r.trim())return r;var t;try{t=CSSO.parse(r)}catch(a){return s.out.warn("CSS parse error: "+e.path),s.out.warn(a.message),r}for(var n=[t];n.length;){var o,u=n.pop();if("uri"===u[0]){var i,S=u[1];if("raw"===S[0])i=S[1],o="";else{if("string"!==S[0]){s.out.warn("Unknown URI type:",S);continue}o=S[1].substring(0,1),i=S[1].substring(1,S[1].length-1),u[1]=S=["raw"]}S[1]=o+rebase(i,e,s)+o}for(var c=u.length-1;c>=0;c--)Array.isArray(u[c])&&n.push(u[c])}try{t=CSSO.compress(t)}catch(f){s.out.warn("CSS compression error: "+e.path),s.out.warn(f.message)}try{t=CSSO.cleanInfo(t)}catch(f){s.out.warn("CSS clean info error: "+e.path),s.out.warn(f.message)}return CSSO.translate(t)}function resolveCss(r,e,s){var t,a,n,o,u,i,S;try{u=CSSO.parse(e)}catch(c){return s.out.warn("CSS parse error prevented embedded CSS to be resolved: "+r),e}if(u)for(t=[u];t.length;){if(o=t.pop(),"uri"===o[0]){if(n=o[1],"raw"===n[0])i=n[1],a="";else{if("string"!==n[0]){s.out.warn("Unknown URI type:",n);continue}a=n[1].substring(0,1),i=n[1].substring(1,n[1].length-1),o[1]=n=["raw"]}i.indexOf(":")===-1&&(n[1]=a+URL.resolve(r,i)+a)}for(S=o.length-1;S>=0;S--)Array.isArray(o[S])&&t.push(o[S])}try{u=CSSO.compress(u)}catch(f){s.out.warn("CSS compression error: "),s.out.warn(f.message)}try{u=CSSO.cleanInfo(u)}catch(f){s.out.warn("CSS clean info error:"),s.out.warn(f.message)}return CSSO.translate(u)}var rebase=require("../rebase"),CSSO=require("csso"),URL=require("url2");module.exports=transformCss,transformCss.rebase=rebaseCss,transformCss.resolve=resolveCss;