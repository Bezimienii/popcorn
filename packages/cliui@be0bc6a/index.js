function UI(t){this.width=t.width,this.wrap=t.wrap,this.rows=[]}function _minWidth(t){var n=t.padding||[];return 1+(n[left]||0)+(n[right]||0)}var wrap=require("wordwrap"),align={right:require("right-align"),center:require("center-align")},top=0,right=1,bottom=2,left=3;UI.prototype.span=function(){var t=this.div.apply(this,arguments);t.span=!0},UI.prototype.div=function(){if(0===arguments.length&&this.div(""),this.wrap&&this._shouldApplyLayoutDSL.apply(this,arguments))return this._applyLayoutDSL(arguments[0]);for(var t,n=[],r=0;void 0!==(t=arguments[r]);r++)"string"==typeof t?n.push(this._colFromString(t)):n.push(t);return this.rows.push(n),n},UI.prototype._shouldApplyLayoutDSL=function(){return 1===arguments.length&&"string"==typeof arguments[0]&&/[\t\n]/.test(arguments[0])},UI.prototype._applyLayoutDSL=function(t){var n=this,r=t.split("\n"),i=0;return r.forEach(function(t){var r=t.split("\t");r.length>1&&r[0].length>i&&(i=Math.min(Math.floor(.5*n.width),r[0].length))}),r.forEach(function(t){var r=t.split("\t");n.div.apply(n,r.map(function(t,n){return{text:t.trim(),padding:[0,t.match(/\s*$/)[0].length,0,t.match(/^\s*/)[0].length],width:0===n&&r.length>1?i:void 0}}))}),this.rows[this.rows.length-1]},UI.prototype._colFromString=function(t){return{text:t}},UI.prototype.toString=function(){var t=this,n=[];return t.rows.forEach(function(r,i){t.rowToString(r,n)}),n=n.filter(function(t){return!t.hidden}),n.map(function(t){return t.text}).join("\n")},UI.prototype.rowToString=function(t,n){var r,i,o,e,a=this,h=this._rasterize(t),p="";return h.forEach(function(h,d){p="",h.forEach(function(h,u){i="",o=t[u].width,e=a._negatePadding(t[u]);for(var f=0;f<Math.max(e,h.length);f++)i+=h.charAt(f)||" ";t[u].align&&"left"!==t[u].align&&a.wrap&&(i=align[t[u].align](i.trim()+"\n"+new Array(e+1).join(" ")).split("\n")[0],i.length<e&&(i+=new Array(o-i.length).join(" "))),r=(t[u].padding||[0,0,0,0])[left],r&&(p+=new Array(t[u].padding[left]+1).join(" ")),p+=i,t[u].padding&&t[u].padding[right]&&(p+=new Array(t[u].padding[right]+1).join(" ")),0===d&&n.length>0&&(p=a._renderInline(p,n[n.length-1],r))}),n.push({text:p.replace(/ +$/,""),span:t.span})}),n},UI.prototype._renderInline=function(t,n,r){var i=n.text,o="";if(!n.span)return t;if(!this.wrap)return n.hidden=!0,i+t;for(var e,a,h=0;h<Math.max(t.length,i.length);h++){if(e=i.charAt(h)||" ",a=t.charAt(h)||" "," "!==e&&" "!==a)return t;if(" "!==a&&h<r+i.length)return t;o+=" "===e?a:e}return n.hidden=!0,o},UI.prototype._rasterize=function(t){var n,r,i,o=this,e=[],a=this._columnWidths(t);return t.forEach(function(t,h){if(t.width=a[h],i=o.wrap?wrap.hard(o._negatePadding(t))(t.text).split("\n"):t.text.split("\n"),t.padding){for(n=0;n<(t.padding[top]||0);n++)i.unshift("");for(n=0;n<(t.padding[bottom]||0);n++)i.push("")}i.forEach(function(t,n){e[n]||e.push([]),r=e[n];for(var i=0;i<h;i++)void 0===r[i]&&r.push("");r.push(t)})}),e},UI.prototype._negatePadding=function(t){var n=t.width;return t.padding&&(n-=(t.padding[left]||0)+(t.padding[right]||0)),n},UI.prototype._columnWidths=function(t){var n,r=this,i=[],o=t.length,e=this.width;return t.forEach(function(t,n){t.width?(o--,i[n]=t.width,e-=t.width):i[n]=void 0}),o&&(n=Math.floor(e/o)),i.forEach(function(o,e){r.wrap?void 0===o&&(i[e]=Math.max(n,_minWidth(t[e]))):i[e]=t[e].width||t[e].text.length}),i},module.exports=function(t){return t=t||{},new UI({width:(t||{}).width||80,wrap:"boolean"!=typeof t.wrap||t.wrap})};