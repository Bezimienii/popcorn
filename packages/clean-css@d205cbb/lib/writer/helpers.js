function supportsAfterClosingBrace(e){return"background"==e[1][1]||"transform"==e[1][1]||"src"==e[1][1]}function afterClosingBrace(e,r){return e[r][1][e[r][1].length-1]==Marker.CLOSE_ROUND_BRACKET}function afterComma(e,r){return e[r][1]==Marker.COMMA}function afterSlash(e,r){return e[r][1]==Marker.FORWARD_SLASH}function beforeComma(e,r){return e[r+1]&&e[r+1][1]==Marker.COMMA}function beforeSlash(e,r){return e[r+1]&&e[r+1][1]==Marker.FORWARD_SLASH}function inFilter(e){return"filter"==e[1][1]||"-ms-filter"==e[1][1]}function disallowsSpace(e,r,a){return!e.spaceAfterClosingBrace&&supportsAfterClosingBrace(r)&&afterClosingBrace(r,a)||beforeSlash(r,a)||afterSlash(r,a)||beforeComma(r,a)||afterComma(r,a)}function rules(e,r){for(var a=e.store,t=0,n=r.length;t<n;t++)a(e,r[t]),t<n-1&&a(e,comma(e))}function body(e,r){for(var a=lastPropertyIndex(r),t=0,n=r.length;t<n;t++)property(e,r,t,a)}function lastPropertyIndex(e){for(var r=e.length-1;r>=0&&e[r][0]==Token.COMMENT;r--);return r}function property(e,r,a,t){var n=e.store,o=r[a],s=o[2][0]==Token.PROPERTY_BLOCK,l=a<t||s,c=a===t;switch(o[0]){case Token.AT_RULE:n(e,o),n(e,semicolon(e,Breaks.AfterProperty,!1));break;case Token.AT_RULE_BLOCK:rules(e,o[1]),n(e,openBrace(e,Breaks.AfterRuleBegins,!0)),body(e,o[2]),n(e,closeBrace(e,Breaks.AfterRuleEnds,!1,c));break;case Token.COMMENT:n(e,o);break;case Token.PROPERTY:n(e,o[1]),n(e,colon(e)),value(e,o),n(e,l?semicolon(e,Breaks.AfterProperty,c):emptyCharacter)}}function value(e,r){var a,t,n=e.store;if(r[2][0]==Token.PROPERTY_BLOCK)n(e,openBrace(e,Breaks.AfterBlockBegins,!1)),body(e,r[2][1]),n(e,closeBrace(e,Breaks.AfterBlockEnds,!1,!0));else for(a=2,t=r.length;a<t;a++)n(e,r[a]),a<t-1&&(inFilter(r)||!disallowsSpace(e,r,a))&&n(e,Marker.SPACE)}function allowsBreak(e,r){return e.format&&e.format.breaks[r]}function allowsSpace(e,r){return e.format&&e.format.spaces[r]}function openBrace(e,r,a){return e.format?(e.indentBy+=e.format.indentBy,e.indentWith=e.format.indentWith.repeat(e.indentBy),(a&&allowsSpace(e,Spaces.BeforeBlockBegins)?Marker.SPACE:emptyCharacter)+Marker.OPEN_CURLY_BRACKET+(allowsBreak(e,r)?lineBreak:emptyCharacter)+e.indentWith):Marker.OPEN_CURLY_BRACKET}function closeBrace(e,r,a,t){return e.format?(e.indentBy-=e.format.indentBy,e.indentWith=e.format.indentWith.repeat(e.indentBy),(allowsBreak(e,Breaks.AfterProperty)||a&&allowsBreak(e,Breaks.BeforeBlockEnds)?lineBreak:emptyCharacter)+e.indentWith+Marker.CLOSE_CURLY_BRACKET+(t?emptyCharacter:(allowsBreak(e,r)?lineBreak:emptyCharacter)+e.indentWith)):Marker.CLOSE_CURLY_BRACKET}function colon(e){return e.format?Marker.COLON+(allowsSpace(e,Spaces.BeforeValue)?Marker.SPACE:emptyCharacter):Marker.COLON}function semicolon(e,r,a){return e.format?Marker.SEMICOLON+(a||!allowsBreak(e,r)?emptyCharacter:lineBreak+e.indentWith):Marker.SEMICOLON}function comma(e){return e.format?Marker.COMMA+(allowsBreak(e,Breaks.BetweenSelectors)?lineBreak:emptyCharacter)+e.indentWith:Marker.COMMA}function all(e,r){var a,t,n,o,s=e.store;for(n=0,o=r.length;n<o;n++)switch(a=r[n],t=n==o-1,a[0]){case Token.AT_RULE:s(e,a),s(e,semicolon(e,Breaks.AfterAtRule,t));break;case Token.AT_RULE_BLOCK:rules(e,a[1]),s(e,openBrace(e,Breaks.AfterRuleBegins,!0)),body(e,a[2]),s(e,closeBrace(e,Breaks.AfterRuleEnds,!1,t));break;case Token.NESTED_BLOCK:rules(e,a[1]),s(e,openBrace(e,Breaks.AfterBlockBegins,!0)),all(e,a[2]),s(e,closeBrace(e,Breaks.AfterBlockEnds,!0,t));break;case Token.COMMENT:s(e,a),s(e,allowsBreak(e,Breaks.AfterComment)?lineBreak:emptyCharacter);break;case Token.RULE:rules(e,a[1]),s(e,openBrace(e,Breaks.AfterRuleBegins,!0)),body(e,a[2]),s(e,closeBrace(e,Breaks.AfterRuleEnds,!1,t))}}var lineBreak=require("os").EOL,emptyCharacter="",Breaks=require("../options/format").Breaks,Spaces=require("../options/format").Spaces,Marker=require("../tokenizer/marker"),Token=require("../tokenizer/token");module.exports={all:all,body:body,property:property,rules:rules,value:value};