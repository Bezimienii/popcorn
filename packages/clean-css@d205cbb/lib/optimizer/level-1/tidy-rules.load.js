montageDefine("d205cbb","lib/optimizer/level-1/tidy-rules",{dependencies:["../../options/format","../../tokenizer/marker","../../utils/format-position"],factory:function(e,i,s){function n(e){var i,s,n,t,r=!1,p=!1;for(n=0,t=e.length;n<t;n++){if(s=e[n],i);else if(s==o.SINGLE_QUOTE||s==o.DOUBLE_QUOTE)p=!p;else{if(!(p||s!=o.CLOSE_CURLY_BRACKET&&s!=o.EXCLAMATION&&s!=L&&s!=o.SEMICOLON)){r=!0;break}if(!p&&0===n&&A.test(s)){r=!0;break}}i=s==o.BACK_SLASH}return r}function t(e,i){var s,n,t,r,p,a,E,h,_,c,O,S,I,L=[],N=0,g=!1,m=!1,C=f.test(e),U=i&&i.spaces[l.AroundSelectorRelation];for(S=0,I=e.length;S<I;S++){if(s=e[S],n=s==o.NEW_LINE_NIX,t=s==o.NEW_LINE_NIX&&e[S-1]==o.NEW_LINE_WIN,a=E||h,c=!_&&!r&&0===N&&A.test(s),O=d.test(s),p&&a&&t)L.pop(),L.pop();else if(r&&a&&n)L.pop();else if(r)L.push(s);else if(s!=o.OPEN_SQUARE_BRACKET||a)if(s!=o.CLOSE_SQUARE_BRACKET||a)if(s!=o.OPEN_ROUND_BRACKET||a)if(s!=o.CLOSE_ROUND_BRACKET||a)if(s!=o.SINGLE_QUOTE||a)if(s!=o.DOUBLE_QUOTE||a)if(s==o.SINGLE_QUOTE&&a)L.push(s),E=!1;else if(s==o.DOUBLE_QUOTE&&a)L.push(s),h=!1;else{if(O&&g&&!U)continue;!O&&g&&U?(L.push(o.SPACE),L.push(s)):O&&(_||N>0)&&!a||O&&m&&!a||(t||n)&&(_||N>0)&&a||(c&&m&&!U?(L.pop(),L.push(s)):c&&!m&&U?(L.push(o.SPACE),L.push(s)):O?L.push(o.SPACE):L.push(s))}else L.push(s),h=!0;else L.push(s),E=!0;else L.push(s),N--;else L.push(s),N++;else L.push(s),_=!1;else L.push(s),_=!0;p=r,r=s==o.BACK_SLASH,g=c,m=O}return C?L.join("").replace(u,"$1 $2]"):L.join("")}function r(e){return e.indexOf("'")==-1&&e.indexOf('"')==-1?e:e.replace(c,"=$1 $2").replace(O,"=$1$2").replace(E,"=$1 $2").replace(h,"=$1$2")}function p(e,i,s,p,l){function o(e,i){return l.push("HTML comment '"+i+"' at "+a(e[2][0])+". Removing."),""}for(var f=[],u=[],E=0,h=e.length;E<h;E++){var c=e[E],O=c[1];O=O.replace(_,o.bind(null,c)),n(O)?l.push("Invalid selector '"+c[1]+"' at "+a(c[2][0])+". Ignoring."):(O=t(O,p),O=r(O),s&&O.indexOf("nav")>0&&(O=O.replace(/\+nav(\S|$)/,"+ nav$1")),i&&O.indexOf(S)>-1||i&&O.indexOf(I)>-1||(O.indexOf("*")>-1&&(O=O.replace(/\*([:#\.\[])/g,"$1").replace(/^(\:first\-child)?\+html/,"*$1+html")),u.indexOf(O)>-1||(c[1]=O,u.push(O),f.push(c))))}return 1==f.length&&0===f[0][1].length&&(l.push("Empty selector '"+f[0][1]+"' at "+a(f[0][2][0])+". Ignoring."),f=[]),f}var l=e("../../options/format").Spaces,o=e("../../tokenizer/marker"),a=e("../../utils/format-position"),f=/[\s"'][iI]\s*\]/,u=/([\d\w])([iI])\]/g,E=/="([a-zA-Z][a-zA-Z\d\-_]+)"([iI])/g,h=/="([a-zA-Z][a-zA-Z\d\-_]+)"(\s|\])/g,_=/^(?:(?:<!--|-->)\s*)+/,c=/='([a-zA-Z][a-zA-Z\d\-_]+)'([iI])/g,O=/='([a-zA-Z][a-zA-Z\d\-_]+)'(\s|\])/g,A=/[>\+~]/,d=/\s/,S="*+html ",I="*:first-child+html ",L="<";s.exports=p}});