function removeQuotes(e){return e.replace(optionalMatchingQuotesRegex,"$2")}function removeUnusedAtRules(e,t){removeUnusedAtRule(e,matchCounterStyle,markCounterStylesAsUsed,t),removeUnusedAtRule(e,matchFontFace,markFontFacesAsUsed,t),removeUnusedAtRule(e,matchKeyframe,markKeyframesAsUsed,t),removeUnusedAtRule(e,matchNamespace,markNamespacesAsUsed,t)}function removeUnusedAtRule(e,t,n,o){var r,a,i,s,m,u,l={};for(m=0,u=e.length;m<u;m++)t(e[m],l);if(0!==Object.keys(l).length){markUsedAtRules(e,n,l,o);for(r in l)for(a=l[r],m=0,u=a.length;m<u;m++)i=a[m],s=i[0]==Token.AT_RULE?1:2,i[s]=[]}}function markUsedAtRules(e,t,n,o){var r,a,i=t(n);for(r=0,a=e.length;r<a;r++)switch(e[r][0]){case Token.RULE:i(e[r],o);break;case Token.NESTED_BLOCK:markUsedAtRules(e[r][2],t,n,o)}}function matchCounterStyle(e,t){var n;e[0]==Token.AT_RULE_BLOCK&&0===e[1][0][1].indexOf("@counter-style")&&(n=e[1][0][1].split(" ")[1],t[n]=t[n]||[],t[n].push(e))}function markCounterStylesAsUsed(e){return function(t,n){var o,r,a,i;for(a=0,i=t[2].length;a<i;a++)o=t[2][a],"list-style"==o[1][1]&&(r=wrapForOptimizing(o),populateComponents([r],n.validator,n.warnings),r.components[0].value[0][1]in e&&delete e[o[2][1]],restoreFromOptimizing([r])),"list-style-type"==o[1][1]&&o[2][1]in e&&delete e[o[2][1]]}}function matchFontFace(e,t){var n,o,r,a;if(e[0]==Token.AT_RULE_BLOCK&&"@font-face"==e[1][0][1])for(r=0,a=e[2].length;r<a;r++)if(n=e[2][r],"font-family"==n[1][1]){o=removeQuotes(n[2][1].toLowerCase()),t[o]=t[o]||[],t[o].push(e);break}}function markFontFacesAsUsed(e){return function(t,n){var o,r,a,i,s,m,u,l;for(s=0,m=t[2].length;s<m;s++){if(o=t[2][s],"font"==o[1][1]){for(r=wrapForOptimizing(o),populateComponents([r],n.validator,n.warnings),a=r.components[6],u=0,l=a.value.length;u<l;u++)i=removeQuotes(a.value[u][1].toLowerCase()),i in e&&delete e[i];restoreFromOptimizing([r])}if("font-family"==o[1][1])for(u=2,l=o.length;u<l;u++)i=removeQuotes(o[u][1].toLowerCase()),i in e&&delete e[i]}}}function matchKeyframe(e,t){var n;e[0]==Token.NESTED_BLOCK&&keyframeRegex.test(e[1][0][1])&&(n=e[1][0][1].split(" ")[1],t[n]=t[n]||[],t[n].push(e))}function markKeyframesAsUsed(e){return function(t,n){var o,r,a,i,s,m,u;for(i=0,s=t[2].length;i<s;i++){if(o=t[2][i],animationRegex.test(o[1][1])){for(r=wrapForOptimizing(o),populateComponents([r],n.validator,n.warnings),a=r.components[7],m=0,u=a.value.length;m<u;m++)a.value[m][1]in e&&delete e[a.value[m][1]];restoreFromOptimizing([r])}if(animationNameRegex.test(o[1][1]))for(m=2,u=o.length;m<u;m++)o[m][1]in e&&delete e[o[m][1]]}}}function matchNamespace(e,t){var n;e[0]==Token.AT_RULE&&0===e[1].indexOf("@namespace")&&(n=e[1].split(" ")[1],t[n]=t[n]||[],t[n].push(e))}function markNamespacesAsUsed(e){var t=new RegExp(Object.keys(e).join("\\||")+"\\|","g");return function(n){var o,r,a,i,s,m,u;for(i=0,s=n[1].length;i<s;i++)for(r=n[1][i],o=r[1].match(t),m=0,u=o.length;m<u;m++)a=o[m].substring(0,o[m].length-1),a in e&&delete e[a]}}var populateComponents=require("./properties/populate-components"),wrapForOptimizing=require("../wrap-for-optimizing").single,restoreFromOptimizing=require("../restore-from-optimizing"),Token=require("../../tokenizer/token"),animationNameRegex=/^(\-moz\-|\-o\-|\-webkit\-)?animation-name$/,animationRegex=/^(\-moz\-|\-o\-|\-webkit\-)?animation$/,keyframeRegex=/^@(\-moz\-|\-o\-|\-webkit\-)?keyframes /,optionalMatchingQuotesRegex=/^(['"]?)(.*)\1$/;module.exports=removeUnusedAtRules;