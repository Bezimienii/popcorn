montageDefine("d205cbb","lib/optimizer/level-2/properties/merge-into-shorthands",{dependencies:["./every-values-pair","./has-inherit","./populate-components","../compactable","../clone","../restore-with-components","../../restore-from-optimizing","../../wrap-for-optimizing","../../../writer/one-time","../../../tokenizer/token"],factory:function(n,e,o){function t(n,e){var o,t,i,a,p,l,u,s={};if(!(n.length<3)){for(a=0,p=n.length;a<p;a++)if(i=n[a],o=E[i.name],!i.unused&&!i.hack&&!i.block&&(r(n,a,s,e),o&&o.componentOf))for(l=0,u=o.componentOf.length;l<u;l++)t=o.componentOf[l],s[t]=s[t]||{},s[t][i.name]=i;r(n,a,s,e)}}function r(n,e,o,t){var r,f,c,h=n[e];for(r in o)void 0!==h&&r==h.name||(f=E[r],c=o[r],h&&i(o,r,h)?delete o[r]:f.components.length>Object.keys(c).length||a(c)||p(c,r,t)&&l(c)&&(u(c)?s(n,c,r,t):P(n,c,r,t)))}function i(n,e,o){var t,r=E[e],i=E[o.name];if("overridesShorthands"in r&&r.overridesShorthands.indexOf(o.name)>-1)return!0;if(i&&"componentOf"in i)for(t in n[e])if(i.componentOf.indexOf(t)>-1)return!0;return!1}function a(n){var e,o;for(o in n){if(void 0!==e&&n[o].important!=e)return!0;e=n[o].important}return!1}function p(n,e,o){var t,r,i,a,p=E[e],l=[V.PROPERTY,[V.PROPERTY_NAME,e],[V.PROPERTY_VALUE,p.defaultValue]],u=Y(l);for(O([u],o,[]),i=0,a=p.components.length;i<a;i++)if(t=n[p.components[i]],r=E[t.name].canOverride,!R(r.bind(null,o),u.components[i],t))return!1;return!0}function l(n){var e,o,t,r,i,a=null;for(o in n)if(t=n[o],r=E[o],"restore"in r){if(A([t.all[t.position]],T),i=r.restore(t,E),e=i.length,null!==a&&e!==a)return!1;a=e}return!0}function u(n){var e,o,t=null;for(e in n){if(o=g(n[e]),null!==t&&t!==o)return!0;t=o}return!1}function s(n,e,o,t){var r,i,a,p,l=f(e,o,t),u=v(e,o,t),s=l[0],c=u[0],h=b(s).length<b(c).length,m=h?s:c,P=h?l[1]:u[1],R=h?l[2]:u[2],g=e[Object.keys(e)[0]].all;P.position=g.length,P.shorthand=!0,P.dirty=!0,P.all=g,P.all.push(m[0]),n.push(P);for(r in e)i=e[r],i.unused=!0,i.name in R&&(a=R[i.name],p=d(m,r),a.position=g.length,a.all=g,a.all.push(p),n.push(a))}function f(n,e,o){var t,r,i,a,p,l,u=[],s={},f={},m=E[e],v=[V.PROPERTY,[V.PROPERTY_NAME,e],[V.PROPERTY_VALUE,m.defaultValue]],d=Y(v);for(O([d],o,[]),p=0,l=m.components.length;p<l;p++)t=n[m.components[p]],g(t)?(r=t.all[t.position].slice(0,2),Array.prototype.push.apply(r,t.value),u.push(r),i=y(t),i.value=c(n,i.name),d.components[p]=i,s[t.name]=y(t)):(i=y(t),i.all=t.all,d.components[p]=i,f[t.name]=t);return a=h(f,1),v[1].push(a),A([d],T),v=v.slice(0,2),Array.prototype.push.apply(v,d.value),u.unshift(v),[u,d,s]}function c(n,e){var o=E[e];return"oppositeTo"in o?n[o.oppositeTo].value:[[V.PROPERTY_VALUE,o.defaultValue]]}function h(n,e){var o,t,r,i,a=[];for(i in n)o=n[i],t=o.all[o.position],r=t[e][t[e].length-1],Array.prototype.push.apply(a,r);return a.sort(m)}function m(n,e){var o=n[0],t=e[0],r=n[1],i=e[1];return o<t?-1:o===t&&r<i?-1:1}function v(n,e,o){var t,r,i,a,p,l,u=[],s={},f={},c=E[e],m=[V.PROPERTY,[V.PROPERTY_NAME,e],[V.PROPERTY_VALUE,"inherit"]],v=Y(m);for(O([v],o,[]),p=0,l=c.components.length;p<l;p++)t=n[c.components[p]],g(t)?s[t.name]=t:(r=t.all[t.position].slice(0,2),Array.prototype.push.apply(r,t.value),u.push(r),f[t.name]=y(t));return i=h(s,1),m[1].push(i),a=h(s,2),m[2].push(a),u.unshift(m),[u,v,f]}function d(n,e){var o,t;for(o=0,t=n.length;o<t;o++)if(n[o][1][1]==e)return n[o]}function P(n,e,o,t){var r,i,a,p=E[o],l=[V.PROPERTY,[V.PROPERTY_NAME,o],[V.PROPERTY_VALUE,p.defaultValue]],u=Y(l);u.shorthand=!0,u.dirty=!0,O([u],t,[]);for(var s=0,f=p.components.length;s<f;s++){var c=e[p.components[s]];u.components[s]=y(c),u.important=c.important,a=c.all}for(var m in e)e[m].unused=!0;r=h(e,1),l[1].push(r),i=h(e,2),l[2].push(i),u.position=a.length,u.all=a,u.all.push(l),n.push(u)}var R=n("./every-values-pair"),g=n("./has-inherit"),O=n("./populate-components"),E=n("../compactable"),y=n("../clone").deep,T=n("../restore-with-components"),A=n("../../restore-from-optimizing"),Y=n("../../wrap-for-optimizing").single,b=n("../../../writer/one-time").body,V=n("../../../tokenizer/token");o.exports=t}});