function _anyIsInherit(e){var a,r;for(a=0,r=e.length;a<r;a++)if("inherit"==e[a][1])return!0;return!1}function _colorFilter(e){return function(a){return"invert"==a[1]||e.isColor(a[1])||e.isPrefixed(a[1])}}function _styleFilter(e){return function(a){return"inherit"!=a[1]&&e.isStyleKeyword(a[1])&&!e.isColorFunction(a[1])}}function _wrapDefault(e,a,r){var i=r[e];return wrapSingle(i.doubleValues&&2==i.defaultValue.length?[Token.PROPERTY,[Token.PROPERTY_NAME,e],[Token.PROPERTY_VALUE,i.defaultValue[0]],[Token.PROPERTY_VALUE,i.defaultValue[1]]]:i.doubleValues&&1==i.defaultValue.length?[Token.PROPERTY,[Token.PROPERTY_NAME,e],[Token.PROPERTY_VALUE,i.defaultValue[0]]]:[Token.PROPERTY,[Token.PROPERTY_NAME,e],[Token.PROPERTY_VALUE,i.defaultValue]])}function _widthFilter(e){return function(a){return"inherit"!=a[1]&&(e.isWidth(a[1])||e.isUnit(a[1])&&!e.isDynamicUnit(a[1]))&&!e.isStyleKeyword(a[1])&&!e.isColorFunction(a[1])}}function animation(e,a,r){var i,n,l,t=_wrapDefault(e.name+"-duration",e,a),o=_wrapDefault(e.name+"-timing-function",e,a),u=_wrapDefault(e.name+"-delay",e,a),s=_wrapDefault(e.name+"-iteration-count",e,a),v=_wrapDefault(e.name+"-direction",e,a),f=_wrapDefault(e.name+"-fill-mode",e,a),d=_wrapDefault(e.name+"-play-state",e,a),g=_wrapDefault(e.name+"-name",e,a),p=[t,o,u,s,v,f,d,g],h=e.value,w=!1,c=!1,m=!1,y=!1,P=!1,_=!1,k=!1,D=!1;if(1==e.value.length&&"inherit"==e.value[0][1])return t.value=o.value=u.value=s.value=v.value=f.value=d.value=g.value=e.value,p;if(h.length>1&&_anyIsInherit(h))throw new InvalidPropertyError("Invalid animation values at "+formatPosition(h[0][2][0])+". Ignoring.");for(n=0,l=h.length;n<l;n++)if(i=h[n],r.isTime(i[1])&&!w)t.value=[i],w=!0;else if(r.isTime(i[1])&&!m)u.value=[i],m=!0;else if(!r.isGlobal(i[1])&&!r.isAnimationTimingFunction(i[1])||c)if(!r.isAnimationIterationCountKeyword(i[1])&&!r.isPositiveNumber(i[1])||y)if(r.isAnimationDirectionKeyword(i[1])&&!P)v.value=[i],P=!0;else if(r.isAnimationFillModeKeyword(i[1])&&!_)f.value=[i],_=!0;else if(r.isAnimationPlayStateKeyword(i[1])&&!k)d.value=[i],k=!0;else{if(!r.isAnimationNameKeyword(i[1])&&!r.isIdentifier(i[1])||D)throw new InvalidPropertyError("Invalid animation value at "+formatPosition(i[2][0])+". Ignoring.");g.value=[i],D=!0}else s.value=[i],y=!0;else o.value=[i],c=!0;return p}function background(e,a,r){var i=_wrapDefault("background-image",e,a),n=_wrapDefault("background-position",e,a),l=_wrapDefault("background-size",e,a),t=_wrapDefault("background-repeat",e,a),o=_wrapDefault("background-attachment",e,a),u=_wrapDefault("background-origin",e,a),s=_wrapDefault("background-clip",e,a),v=_wrapDefault("background-color",e,a),f=[i,n,l,t,o,u,s,v],d=e.value,g=!1,p=!1,h=!1,w=!1,c=!1;if(1==e.value.length&&"inherit"==e.value[0][1])return v.value=i.value=t.value=n.value=l.value=u.value=s.value=e.value,f;if(1==e.value.length&&"0 0"==e.value[0][1])return f;for(var m=d.length-1;m>=0;m--){var y=d[m];if(r.isBackgroundAttachmentKeyword(y[1]))o.value=[y],c=!0;else if(r.isBackgroundClipKeyword(y[1])||r.isBackgroundOriginKeyword(y[1]))p?(u.value=[y],h=!0):(s.value=[y],p=!0),c=!0;else if(r.isBackgroundRepeatKeyword(y[1]))w?t.value.unshift(y):(t.value=[y],w=!0),c=!0;else if(r.isBackgroundPositionKeyword(y[1])||r.isBackgroundSizeKeyword(y[1])||r.isUnit(y[1])||r.isDynamicUnit(y[1])){if(m>0){var P=d[m-1];P[1]==Marker.FORWARD_SLASH?l.value=[y]:m>1&&d[m-2][1]==Marker.FORWARD_SLASH?(l.value=[P,y],m-=2):(g||(n.value=[]),n.value.unshift(y),g=!0)}else g||(n.value=[]),n.value.unshift(y),g=!0;c=!0}else v.value[0][1]!=a[v.name].defaultValue&&"none"!=v.value[0][1]||!r.isColor(y[1])&&!r.isPrefixed(y[1])?(r.isUrl(y[1])||r.isFunction(y[1]))&&(i.value=[y],c=!0):(v.value=[y],c=!0)}if(p&&!h&&(u.value=s.value.slice(0)),!c)throw new InvalidPropertyError("Invalid background value at "+formatPosition(d[0][2][0])+". Ignoring.");return f}function borderRadius(e,a){for(var r=e.value,i=-1,n=0,l=r.length;n<l;n++)if(r[n][1]==Marker.FORWARD_SLASH){i=n;break}if(0===i||i===r.length-1)throw new InvalidPropertyError("Invalid border-radius value at "+formatPosition(r[0][2][0])+". Ignoring.");var t=_wrapDefault(e.name,e,a);t.value=i>-1?r.slice(0,i):r.slice(0),t.components=fourValues(t,a);var o=_wrapDefault(e.name,e,a);o.value=i>-1?r.slice(i+1):r.slice(0),o.components=fourValues(o,a);for(var u=0;u<4;u++)t.components[u].multiplex=!0,t.components[u].value=t.components[u].value.concat(o.components[u].value);return t.components}function font(e,a,r){var i,n,l,t,o=_wrapDefault("font-style",e,a),u=_wrapDefault("font-variant",e,a),s=_wrapDefault("font-weight",e,a),v=_wrapDefault("font-stretch",e,a),f=_wrapDefault("font-size",e,a),d=_wrapDefault("line-height",e,a),g=_wrapDefault("font-family",e,a),p=[o,u,s,v,f,d,g],h=e.value,w=4,c=0,m=!1,y=!1,P=!1,_=!1,k=!1,D=!1;if(!h[c])throw new InvalidPropertyError("Missing font values at "+formatPosition(e.all[e.position][1][2][0])+". Ignoring.");if(1==h.length&&"inherit"==h[0][1])return o.value=u.value=s.value=v.value=f.value=d.value=g.value=h,p;if(1==h.length&&(r.isFontKeyword(h[0][1])||r.isGlobal(h[0][1])||r.isPrefixed(h[0][1])))return h[0][1]=Marker.INTERNAL+h[0][1],o.value=u.value=s.value=v.value=f.value=d.value=g.value=h,p;if(h.length>1&&_anyIsInherit(h))throw new InvalidPropertyError("Invalid font values at "+formatPosition(h[0][2][0])+". Ignoring.");for(;c<w;){if(i=r.isFontStretchKeyword(h[c][1])||r.isGlobal(h[c][1]),n=r.isFontStyleKeyword(h[c][1])||r.isGlobal(h[c][1]),l=r.isFontVariantKeyword(h[c][1])||r.isGlobal(h[c][1]),t=r.isFontWeightKeyword(h[c][1])||r.isGlobal(h[c][1]),n&&!y)o.value=[h[c]],y=!0;else if(l&&!P)u.value=[h[c]],P=!0;else if(t&&!_)s.value=[h[c]],_=!0;else{if(!i||m){if(n&&y||l&&P||t&&_||i&&m)throw new InvalidPropertyError("Invalid font style / variant / weight / stretch value at "+formatPosition(h[0][2][0])+". Ignoring.");break}v.value=[h[c]],m=!0}c++}if(!(r.isFontSizeKeyword(h[c][1])||r.isUnit(h[c][1])&&!r.isDynamicUnit(h[c][1])))throw new InvalidPropertyError("Missing font size at "+formatPosition(h[0][2][0])+". Ignoring.");if(f.value=[h[c]],k=!0,c++,!h[c])throw new InvalidPropertyError("Missing font family at "+formatPosition(h[0][2][0])+". Ignoring.");for(k&&h[c]&&h[c][1]==Marker.FORWARD_SLASH&&h[c+1]&&(r.isLineHeightKeyword(h[c+1][1])||r.isUnit(h[c+1][1])||r.isNumber(h[c+1][1]))&&(d.value=[h[c+1]],c++,c++),g.value=[];h[c];)h[c][1]==Marker.COMMA?D=!1:(D?g.value[g.value.length-1][1]+=Marker.SPACE+h[c][1]:g.value.push(h[c]),D=!0),c++;if(0===g.value.length)throw new InvalidPropertyError("Missing font family at "+formatPosition(h[0][2][0])+". Ignoring.");return p}function fourValues(e,a){var r=a[e.name].components,i=[],n=e.value;if(n.length<1)return[];n.length<2&&(n[1]=n[0].slice(0)),n.length<3&&(n[2]=n[0].slice(0)),n.length<4&&(n[3]=n[1].slice(0));for(var l=r.length-1;l>=0;l--){var t=wrapSingle([Token.PROPERTY,[Token.PROPERTY_NAME,r[l]]]);t.value=[n[l]],i.unshift(t)}return i}function multiplex(e){return function(a,r,i){var n,l,t,o,u=[],s=a.value;for(n=0,t=s.length;n<t;n++)","==s[n][1]&&u.push(n);if(0===u.length)return e(a,r,i);var v=[];for(n=0,t=u.length;n<=t;n++){var f=0===n?0:u[n-1]+1,d=n<t?u[n]:s.length,g=_wrapDefault(a.name,a,r);g.value=s.slice(f,d),v.push(e(g,r,i))}var p=v[0];for(n=0,t=p.length;n<t;n++)for(p[n].multiplex=!0,l=1,o=v.length;l<o;l++)p[n].value.push([Token.PROPERTY_VALUE,Marker.COMMA]),Array.prototype.push.apply(p[n].value,v[l][n].value);return p}}function listStyle(e,a,r){var i=_wrapDefault("list-style-type",e,a),n=_wrapDefault("list-style-position",e,a),l=_wrapDefault("list-style-image",e,a),t=[i,n,l];if(1==e.value.length&&"inherit"==e.value[0][1])return i.value=n.value=l.value=[e.value[0]],t;var o=e.value.slice(0),u=o.length,s=0;for(s=0,u=o.length;s<u;s++)if(r.isUrl(o[s][1])||"0"==o[s][1]){l.value=[o[s]],o.splice(s,1);break}for(s=0,u=o.length;s<u;s++)if(r.isListStylePositionKeyword(o[s][1])){n.value=[o[s]],o.splice(s,1);break}return o.length>0&&(r.isListStyleTypeKeyword(o[0][1])||r.isIdentifier(o[0][1]))&&(i.value=[o[0]]),t}function widthStyleColor(e,a,r){for(var i,n,l,t=a[e.name],o=[_wrapDefault(t.components[0],e,a),_wrapDefault(t.components[1],e,a),_wrapDefault(t.components[2],e,a)],u=0;u<3;u++){var s=o[u];s.name.indexOf("color")>0?i=s:s.name.indexOf("style")>0?n=s:l=s}if(1==e.value.length&&"inherit"==e.value[0][1]||3==e.value.length&&"inherit"==e.value[0][1]&&"inherit"==e.value[1][1]&&"inherit"==e.value[2][1])return i.value=n.value=l.value=[e.value[0]],o;var v,f,d=e.value.slice(0);return d.length>0&&(f=d.filter(_widthFilter(r)),v=f.length>1&&("none"==f[0][1]||"auto"==f[0][1])?f[1]:f[0],v&&(l.value=[v],d.splice(d.indexOf(v),1))),d.length>0&&(v=d.filter(_styleFilter(r))[0],v&&(n.value=[v],d.splice(d.indexOf(v),1))),d.length>0&&(v=d.filter(_colorFilter(r))[0],v&&(i.value=[v],d.splice(d.indexOf(v),1))),o}var InvalidPropertyError=require("./invalid-property-error"),wrapSingle=require("../wrap-for-optimizing").single,Token=require("../../tokenizer/token"),Marker=require("../../tokenizer/marker"),formatPosition=require("../../utils/format-position");module.exports={animation:animation,background:background,border:widthStyleColor,borderRadius:borderRadius,font:font,fourValues:fourValues,listStyle:listStyle,multiplex:multiplex,outline:widthStyleColor};