montageDefine("d205cbb","lib/reader/read-sources",{dependencies:["fs","path","./apply-source-maps","./extract-import-url-and-media","./is-allowed-resource","./load-original-sources","./normalize-path","./rebase","./rebase-local-map","./rebase-remote-map","./restore-import","../tokenizer/tokenize","../tokenizer/token","../tokenizer/marker","../utils/has-protocol","../utils/is-import","../utils/is-remote-resource"],factory:function(e,o,n){function t(e,o,n){return r(e,o,function(e){return y(e,o,function(){return z(o,function(){return n(e)})})})}function r(e,o,n){return"string"==typeof e?s(e,o,n):Buffer.isBuffer(e)?s(e.toString(),o,n):Array.isArray(e)?i(e,o,n):"object"==typeof e?u(e,o,n):void 0}function s(e,o,n){return o.source=void 0,o.sourcesContent[void 0]=e,o.stats.originalSize+=e.length,k(e,o,{inline:o.options.inline},n)}function i(e,o,n){var t=e.reduce(function(e,n){return"string"==typeof n?a(n,e):l(n,o,e)},[]);return k(t.join(""),o,{inline:["all"]},n)}function u(e,o,n){var t=l(e,o,[]);return k(t.join(""),o,{inline:["all"]},n)}function a(e,o){return o.push(f(c(e))),o}function l(e,o,n){var t,r,s;for(t in e)s=e[t],r=c(t),n.push(f(r)),o.sourcesContent[r]=s.styles,s.sourceMap&&p(s.sourceMap,r,o);return n}function c(e){var o,n,t,r=v.resolve("");return j(e)?e:(o=v.isAbsolute(e)?e:v.resolve(e),n=v.relative(r,o),t=B(n))}function p(e,o,n){var t="string"==typeof e?JSON.parse(e):e,r=j(o)?I(t,o):E(t,o||q,n.options.rebaseTo);n.inputSourceMapTracker.track(o,r)}function f(e){return R("url("+e+")","")+L.SEMICOLON}function k(e,o,n,t){var r,s={};return o.source?j(o.source)?(s.fromBase=o.source,s.toBase=o.source):v.isAbsolute(o.source)?(s.fromBase=v.dirname(o.source),s.toBase=o.options.rebaseTo):(s.fromBase=v.dirname(v.resolve(o.source)),s.toBase=o.options.rebaseTo):(s.fromBase=v.resolve(""),s.toBase=o.options.rebaseTo),r=A(e,o),r=O(r,o.options.rebase,o.validator,s),T(n.inline)?m(r,o,n,t):t(r)}function T(e){return!(1==e.length&&"none"==e[0])}function m(e,o,n,t){var r={afterContent:!1,callback:t,errors:o.errors,externalContext:o,fetch:o.options.fetch,inlinedStylesheets:n.inlinedStylesheets||o.inlinedStylesheets,inline:n.inline,inlineRequest:o.options.inlineRequest,inlineTimeout:o.options.inlineTimeout,isRemote:n.isRemote||!1,localOnly:o.localOnly,outputTokens:[],rebaseTo:o.options.rebaseTo,sourceTokens:e,warnings:o.warnings};return g(r)}function g(e){var o,n,t;for(n=0,t=e.sourceTokens.length;n<t;n++){if(o=e.sourceTokens[n],o[0]==M.AT_RULE&&_(o[1]))return e.sourceTokens.splice(0,n),h(o,e);o[0]==M.AT_RULE||o[0]==M.COMMENT?e.outputTokens.push(o):(e.outputTokens.push(o),e.afterContent=!0)}return e.sourceTokens=[],e.callback(e.outputTokens)}function h(e,o){var n=S(e[1]),t=n[0],r=n[1],s=e[2];return j(t)?d(t,r,s,o):x(t,r,s,o)}function d(e,o,n,t){function r(r,s){return r?(t.errors.push('Broken @import declaration of "'+e+'" - '+r),process.nextTick(function(){t.outputTokens=t.outputTokens.concat(t.sourceTokens.slice(0,1)),t.sourceTokens=t.sourceTokens.slice(1),g(t)})):(t.inline=t.externalContext.options.inline,t.isRemote=!0,t.externalContext.source=i,t.externalContext.sourcesContent[e]=s,t.externalContext.stats.originalSize+=s.length,k(s,t.externalContext,t,function(e){return e=C(e,o,n),t.outputTokens=t.outputTokens.concat(e),t.sourceTokens=t.sourceTokens.slice(1),g(t)}))}var s=w(e,!0,t.inline),i=e,u=e in t.externalContext.sourcesContent,a=!N(e);return t.inlinedStylesheets.indexOf(e)>-1?(t.warnings.push('Ignoring remote @import of "'+e+'" as it has already been imported.'),t.sourceTokens=t.sourceTokens.slice(1),g(t)):t.localOnly&&t.afterContent?(t.warnings.push('Ignoring remote @import of "'+e+'" as no callback given and after other content.'),t.sourceTokens=t.sourceTokens.slice(1),g(t)):a?(t.warnings.push('Skipping remote @import of "'+e+'" as no protocol given.'),t.outputTokens=t.outputTokens.concat(t.sourceTokens.slice(0,1)),t.sourceTokens=t.sourceTokens.slice(1),g(t)):t.localOnly&&!u?(t.warnings.push('Skipping remote @import of "'+e+'" as no callback given.'),t.outputTokens=t.outputTokens.concat(t.sourceTokens.slice(0,1)),t.sourceTokens=t.sourceTokens.slice(1),g(t)):!s&&t.afterContent?(t.warnings.push('Ignoring remote @import of "'+e+'" as resource is not allowed and after other content.'),t.sourceTokens=t.sourceTokens.slice(1),g(t)):s?(t.inlinedStylesheets.push(e),u?r(null,t.externalContext.sourcesContent[e]):t.fetch(e,t.inlineRequest,t.inlineTimeout,r)):(t.warnings.push('Skipping remote @import of "'+e+'" as resource is not allowed.'),t.outputTokens=t.outputTokens.concat(t.sourceTokens.slice(0,1)),t.sourceTokens=t.sourceTokens.slice(1),g(t))}function x(e,o,n,t){var r,s=v.resolve(""),i=v.isAbsolute(e)?v.resolve(s,"/"==e[0]?e.substring(1):e):v.resolve(t.rebaseTo,e),u=v.relative(s,i),a=w(e,!1,t.inline),l=B(u),c=l in t.externalContext.sourcesContent;if(t.inlinedStylesheets.indexOf(i)>-1)t.warnings.push('Ignoring local @import of "'+e+'" as it has already been imported.');else if(c||b.existsSync(i)&&b.statSync(i).isFile())if(!a&&t.afterContent)t.warnings.push('Ignoring local @import of "'+e+'" as resource is not allowed and after other content.');else if(t.afterContent)t.warnings.push('Ignoring local @import of "'+e+'" as after other content.');else{if(a)return r=c?t.externalContext.sourcesContent[l]:b.readFileSync(i,"utf-8"),t.inlinedStylesheets.push(i),t.inline=t.externalContext.options.inline,t.externalContext.source=l,t.externalContext.sourcesContent[l]=r,t.externalContext.stats.originalSize+=r.length,k(r,t.externalContext,t,function(e){return e=C(e,o,n),t.outputTokens=t.outputTokens.concat(e),t.sourceTokens=t.sourceTokens.slice(1),g(t)});t.warnings.push('Skipping local @import of "'+e+'" as resource is not allowed.'),t.outputTokens=t.outputTokens.concat(t.sourceTokens.slice(0,1))}else t.errors.push('Ignoring local @import of "'+e+'" as resource is missing.');return t.sourceTokens=t.sourceTokens.slice(1),g(t)}function C(e,o,n){return o?[[M.NESTED_BLOCK,[[M.NESTED_BLOCK_SCOPE,"@media "+o,n]],e]]:e}var b=e("fs"),v=e("path"),y=e("./apply-source-maps"),S=e("./extract-import-url-and-media"),w=e("./is-allowed-resource"),z=e("./load-original-sources"),B=e("./normalize-path"),O=e("./rebase"),E=e("./rebase-local-map"),I=e("./rebase-remote-map"),R=e("./restore-import"),A=e("../tokenizer/tokenize"),M=e("../tokenizer/token"),L=e("../tokenizer/marker"),N=e("../utils/has-protocol"),_=e("../utils/is-import"),j=e("../utils/is-remote-resource"),q="uri:unknown";n.exports=t}});