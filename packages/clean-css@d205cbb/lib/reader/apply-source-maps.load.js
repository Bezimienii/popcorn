montageDefine("d205cbb","lib/reader/apply-source-maps",{dependencies:["fs","path","./is-allowed-resource","./match-data-uri","./rebase-local-map","./rebase-remote-map","../tokenizer/token","../utils/has-protocol","../utils/is-data-uri-resource","../utils/is-remote-resource"],factory:function(e,n,r){function s(e,n,r){var s={callback:r,fetch:n.options.fetch,index:0,inline:n.options.inline,inlineRequest:n.options.inlineRequest,inlineTimeout:n.options.inlineTimeout,inputSourceMapTracker:n.inputSourceMapTracker,localOnly:n.localOnly,processedTokens:[],rebaseTo:n.options.rebaseTo,sourceTokens:e,warnings:n.warnings};return n.options.sourceMap&&e.length>0?a(s):r(e)}function a(e){var n,r,s,a=[],t=o(e.sourceTokens[0]);for(s=e.sourceTokens.length;e.index<s;e.index++)if(r=e.sourceTokens[e.index],n=o(r),n!=t&&(a=[],t=n),a.push(r),e.processedTokens.push(r),r[0]==E.COMMENT&&S.test(r[1]))return i(r[1],n,a,e);return e.callback(e.processedTokens)}function o(e){var n,r;return e[0]==E.AT_RULE||e[0]==E.COMMENT?r=e[2][0]:(n=e[1][0],r=n[2][0]),r[2]}function i(e,n,r,s){return t(e,s,function(e){return e&&(s.inputSourceMapTracker.track(n,e),p(r,s.inputSourceMapTracker)),s.index++,a(s)})}function t(e,n,r){var s,a,o,i=S.exec(e)[1];return m(i)?(a=c(i),r(a)):R(i)?u(i,n,function(e){var n;e?(n=JSON.parse(e),o=d(n,i),r(o)):r(null)}):(s=k.resolve(n.rebaseTo,i),a=l(s,n),a?(o=g(a,s,n.rebaseTo),r(o)):r(null))}function c(e){var n=b(e),r=n[2]?n[2].split(/[=;]/)[2]:"us-ascii",s=n[3]?n[3].split(";")[1]:"utf8",a="utf8"==s?global.unescape(n[4]):n[4],o=new Buffer(a,s);return o.charset=r,JSON.parse(o.toString())}function u(e,n,r){var s=h(e,!0,n.inline),a=!O(e);return n.localOnly?(n.warnings.push('Cannot fetch remote resource from "'+e+'" as no callback given.'),r(null)):a?(n.warnings.push('Cannot fetch "'+e+'" as no protocol given.'),r(null)):s?void n.fetch(e,n.inlineRequest,n.inlineTimeout,function(s,a){return s?(n.warnings.push('Missing source map at "'+e+'" - '+s),r(null)):void r(a)}):(n.warnings.push('Cannot fetch "'+e+'" as resource is not allowed.'),r(null))}function l(e,n){var r,s=h(e,!1,n.inline);return T.existsSync(e)&&T.statSync(e).isFile()?s?(r=T.readFileSync(e,"utf-8"),JSON.parse(r)):(n.warnings.push('Cannot fetch "'+e+'" as resource is not allowed.'),null):(n.warnings.push('Ignoring local source map at "'+e+'" as resource is missing.'),null)}function p(e,n){var r,s,a;for(s=0,a=e.length;s<a;s++)switch(r=e[s],r[0]){case E.AT_RULE:f(r,n);break;case E.AT_RULE_BLOCK:p(r[1],n),p(r[2],n);break;case E.AT_RULE_BLOCK_SCOPE:f(r,n);break;case E.NESTED_BLOCK:p(r[1],n),p(r[2],n);break;case E.NESTED_BLOCK_SCOPE:f(r,n);break;case E.COMMENT:f(r,n);break;case E.PROPERTY:p(r,n);break;case E.PROPERTY_BLOCK:p(r[1],n);break;case E.PROPERTY_NAME:f(r,n);break;case E.PROPERTY_VALUE:f(r,n);break;case E.RULE:p(r[1],n),p(r[2],n);break;case E.RULE_SCOPE:f(r,n)}return e}function f(e,n){var r,s,a=e[1],o=e[2],i=[];for(r=0,s=o.length;r<s;r++)i.push(n.originalPositionFor(o[r],a.length));e[2]=i}var T=e("fs"),k=e("path"),h=e("./is-allowed-resource"),b=e("./match-data-uri"),g=e("./rebase-local-map"),d=e("./rebase-remote-map"),E=e("../tokenizer/token"),O=e("../utils/has-protocol"),m=e("../utils/is-data-uri-resource"),R=e("../utils/is-remote-resource"),S=/^\/\*# sourceMappingURL=(\S+) \*\/$/;r.exports=s}});