function rebase(e,r){return r?isAbsolute(e)&&!isRemote(r.toBase)?e:isRemote(e)||isSVGMarker(e)||isInternal(e)?e:isData(e)?"'"+e+"'":isRemote(r.toBase)?url.resolve(r.toBase,e):normalize(r.absolute?absolute(e,r):relative(e,r)):e}function isAbsolute(e){return path.isAbsolute(e)}function isSVGMarker(e){return"#"==e[0]}function isInternal(e){return/^\w+:\w+/.test(e)}function isRemote(e){return/^[^:]+?:\/\//.test(e)||0===e.indexOf("//")}function isData(e){return 0===e.indexOf("data:")}function absolute(e,r){return path.resolve(path.join(r.fromBase||"",e)).replace(r.toBase,"")}function relative(e,r){return path.relative(r.toBase,path.join(r.fromBase||"",e))}function normalize(e){return isWindows?e.replace(/\\/g,"/"):e}function quoteFor(e){return e.indexOf(SINGLE_QUOTE)>-1?DOUBLE_QUOTE:e.indexOf(DOUBLE_QUOTE)>-1?SINGLE_QUOTE:hasWhitespace(e)||hasRoundBrackets(e)?SINGLE_QUOTE:""}function hasWhitespace(e){return WHITESPACE_PATTERN.test(e)}function hasRoundBrackets(e){return ROUND_BRACKETS_PATTERN.test(e)}function rewriteUrl(e,r,t){var n=e.replace(URL_PREFIX_PATTERN,"").replace(URL_SUFFIX_PATTERN,"").trim(),a=n.replace(QUOTE_PREFIX_PATTERN,"").replace(QUOTE_SUFFIX_PATTERN,"").trim(),i=n[0]==SINGLE_QUOTE||n[0]==DOUBLE_QUOTE?n[0]:quoteFor(a);return t?rebase(a,r):URL_PREFIX+i+rebase(a,r)+i+URL_SUFFIX}var path=require("path"),url=require("url"),DOUBLE_QUOTE='"',SINGLE_QUOTE="'",URL_PREFIX="url(",URL_SUFFIX=")",QUOTE_PREFIX_PATTERN=/^["']/,QUOTE_SUFFIX_PATTERN=/["']$/,ROUND_BRACKETS_PATTERN=/[\(\)]/,URL_PREFIX_PATTERN=/^url\(/i,URL_SUFFIX_PATTERN=/\)$/,WHITESPACE_PATTERN=/\s/,isWindows="win32"==process.platform;module.exports=rewriteUrl;