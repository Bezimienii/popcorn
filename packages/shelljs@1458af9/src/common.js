function log(){config.silent||console.log.apply(this,arguments)}function error(r,n){if(null===state.error&&(state.error=""),state.error+=state.currentCmd+": "+r+"\n",r.length>0&&log(state.error),config.fatal&&process.exit(1),!n)throw""}function ShellString(r){return r}function parseOptions(r,n){n||error("parseOptions() internal error: no map given");var t={};for(var e in n)t[n[e]]=!1;if(!r)return t;"string"!=typeof r&&error("parseOptions() internal error: wrong str");var o=r.match(/^\-(.+)/);if(!o)return t;var s=o[1].split("");return s.forEach(function(r){r in n?t[n[r]]=!0:error("option not recognized: "+r)}),t}function expand(r){var n=[];return r.forEach(function(r){if(r.search(/\*[^\/]*\//)>-1||r.search(/\*\*[^\/]*\//)>-1){var t=r.match(/^([^*]+\/|)(.*)/),e=t[1],o=t[2],s=o.replace(/\*\*/g,".*").replace(/\*/g,"[^\\/]*");s=new RegExp(s),_ls("-R",e).filter(function(r){return s.test(r)}).forEach(function(r){n.push(r)})}else r.search(/\*/)>-1?_ls("",r).forEach(function(r){n.push(r)}):n.push(r)}),n}function unlinkSync(r){try{fs.unlinkSync(r)}catch(n){if("EPERM"!==n.code)throw n;fs.chmodSync(r,"0666"),fs.unlinkSync(r)}}function randomFileName(){function r(n){if(1===n)return parseInt(16*Math.random(),10).toString(16);for(var t="",e=0;e<n;e++)t+=r(1);return t}return"shelljs_"+r(20)}function extend(r){var n=[].slice.call(arguments,1);return n.forEach(function(n){for(var t in n)r[t]=n[t]}),r}function wrap(r,n,t){return function(){var e=null;state.currentCmd=r,state.error=null;try{var o=[].slice.call(arguments,0);t&&t.notUnix?e=n.apply(this,o):(0!==o.length&&"string"==typeof o[0]&&"-"===o[0][0]||o.unshift(""),e=n.apply(this,o))}catch(s){if(state.error||(console.log("shell.js: internal error"),console.log(s.stack||s),process.exit(1)),config.fatal)throw s}return state.currentCmd="shell.js",e}}var os=require("os"),fs=require("fs"),_ls=require("./ls"),config={silent:!1,fatal:!1};exports.config=config;var state={error:null,currentCmd:"shell.js",tempDir:null};exports.state=state;var platform=os.type().match(/^Win/)?"win":"unix";exports.platform=platform,exports.log=log,exports.error=error,exports.ShellString=ShellString,exports.parseOptions=parseOptions,exports.expand=expand,exports.unlinkSync=unlinkSync,exports.randomFileName=randomFileName,exports.extend=extend,exports.wrap=wrap;