"use strict";function makeMap(e){return createMapFromString(e,!0)}function attrForHandler(e){var t=singleAttrIdentifier.source+"(?:\\s*("+joinSingleAttrAssigns(e)+")[ \\t\\n\\f\\r]*(?:"+singleAttrValues.join("|")+"))?";if(e.customAttrSurround){for(var n=[],r=e.customAttrSurround.length-1;r>=0;r--)n[r]="(?:("+e.customAttrSurround[r][0].source+")\\s*"+t+"\\s*("+e.customAttrSurround[r][1].source+"))";n.push("(?:"+t+")"),t="(?:"+n.join("|")+")"}return new RegExp("^\\s*"+t)}function joinSingleAttrAssigns(e){return singleAttrAssigns.concat(e.customAttrAssign||[]).map(function(e){return"(?:"+e.source+")"}).join("|")}function HTMLParser(e,t){function n(e){var t=e.match(startTagOpen);if(t){var n={tagName:t[1],attrs:[]};e=e.slice(t[0].length);for(var r,a;!(r=e.match(startTagClose))&&(a=e.match(l));)e=e.slice(a[0].length),n.attrs.push(a);if(r)return n.unarySlash=r[1],n.rest=e.slice(r[0].length),n}}function r(e){var n=e.tagName,r=e.unarySlash;if(t.html5&&"p"===o&&nonPhrasing(n)&&a("",o),!t.html5&&!inline(n))for(;o&&inline(o);)a("",o);closeSelf(n)&&o===n&&a("",n);var i=empty(n)||"html"===n&&"head"===o||!!r,s=e.attrs.map(function(e){function n(t){return s=e[t],a=e[t+1],"undefined"!=typeof a?'"':(a=e[t+2],"undefined"!=typeof a?"'":(a=e[t+3],"undefined"==typeof a&&fillAttrs(r)&&(a=r),""))}var r,a,o,i,s,c,u=7;IS_REGEX_CAPTURING_BROKEN&&e[0].indexOf('""')===-1&&(""===e[3]&&delete e[3],""===e[4]&&delete e[4],""===e[5]&&delete e[5]);var l=1;if(t.customAttrSurround)for(var m=0,d=t.customAttrSurround.length;m<d;m++,l+=u)if(r=e[l+1]){c=n(l+2),o=e[l],i=e[l+6];break}return!r&&(r=e[l])&&(c=n(l+1)),{name:r,value:a,customAssign:s||"=",customOpen:o||"",customClose:i||"",quote:c||""}});i||(u.push({tag:n,attrs:s}),o=n,r=""),t.start&&t.start(n,s,i,r)}function a(e,n){var r;if(n){var a=n.toLowerCase();for(r=u.length-1;r>=0&&u[r].tag.toLowerCase()!==a;r--);}else r=0;if(r>=0){for(var i=u.length-1;i>=r;i--)t.end&&t.end(u[i].tag,u[i].attrs,i>r||!e);u.length=r,o=r&&u[r-1].tag}else"br"===n.toLowerCase()?t.start&&t.start(n,[],!0,""):"p"===n.toLowerCase()&&(t.start&&t.start(n,[],!1,"",!0),t.end&&t.end(n,[]))}for(var o,i,s,c,u=[],l=attrForHandler(t);e;){if(i=e,o&&special(o)){var m=o.toLowerCase(),d=reCache[m]||(reCache[m]=new RegExp("([\\s\\S]*?)</"+m+"[^>]*>","i"));e=e.replace(d,function(e,n){return"script"!==m&&"style"!==m&&"noscript"!==m&&(n=n.replace(/<!--([\s\S]*?)-->/g,"$1").replace(/<!\[CDATA\[([\s\S]*?)]]>/g,"$1")),t.chars&&t.chars(n),""}),a("</"+m+">",m)}else{var p=e.indexOf("<");if(0===p){if(/^<!--/.test(e)){var f=e.indexOf("-->");if(f>=0){t.comment&&t.comment(e.substring(4,f)),e=e.substring(f+3),s="";continue}}if(/^<!\[/.test(e)){var g=e.indexOf("]>");if(g>=0){t.comment&&t.comment(e.substring(2,g+1),!0),e=e.substring(g+2),s="";continue}}var h=e.match(doctype);if(h){t.doctype&&t.doctype(h[0]),e=e.substring(h[0].length),s="";continue}var v=e.match(endTag);if(v){e=e.substring(v[0].length),v[0].replace(endTag,a),s="/"+v[1].toLowerCase();continue}var b=n(e);if(b){e=b.rest,r(b),s=b.tagName.toLowerCase();continue}}var A;p>=0?(A=e.substring(0,p),e=e.substring(p)):(A=e,e="");var y=n(e);y?c=y.tagName:(y=e.match(endTag),c=y?"/"+y[1]:""),t.chars&&t.chars(A,s,c),s=""}if(e===i)throw new Error("Parse Error: "+e)}t.partialMarkup||a()}var createMapFromString=require("./utils").createMapFromString,singleAttrIdentifier=/([^\s"'<>\/=]+)/,singleAttrAssigns=[/=/],singleAttrValues=[/"([^"]*)"+/.source,/'([^']*)'+/.source,/([^ \t\n\f\r"'`=<>]+)/.source],qnameCapture=function(){var e=require("ncname").source.slice(1,-1);return"((?:"+e+"\\:)?"+e+")"}(),startTagOpen=new RegExp("^<"+qnameCapture),startTagClose=/^\s*(\/?)>/,endTag=new RegExp("^<\\/"+qnameCapture+"[^>]*>"),doctype=/^<!DOCTYPE [^>]+>/i,IS_REGEX_CAPTURING_BROKEN=!1;"x".replace(/x(.)?/g,function(e,t){IS_REGEX_CAPTURING_BROKEN=""===t});var empty=makeMap("area,base,basefont,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr"),inline=makeMap("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,noscript,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,svg,textarea,tt,u,var"),closeSelf=makeMap("colgroup,dd,dt,li,option,p,td,tfoot,th,thead,tr,source"),fillAttrs=makeMap("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),special=makeMap("script,style"),nonPhrasing=makeMap("address,article,aside,base,blockquote,body,caption,col,colgroup,dd,details,dialog,div,dl,dt,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,head,header,hgroup,hr,html,legend,li,menuitem,meta,optgroup,option,param,rp,rt,source,style,summary,tbody,td,tfoot,th,thead,title,tr,track"),reCache={};exports.HTMLParser=HTMLParser,exports.HTMLtoXML=function(e){var t="";return new HTMLParser(e,{start:function(e,n,r){t+="<"+e;for(var a=0,o=n.length;a<o;a++)t+=" "+n[a].name+'="'+(n[a].value||"").replace(/"/g,"&#34;")+'"';t+=(r?"/":"")+">"},end:function(e){t+="</"+e+">"},chars:function(e){t+=e},comment:function(e){t+="<!--"+e+"-->"},ignore:function(e){t+=e}}),t},exports.HTMLtoDOM=function(e,t){var n={html:!0,head:!0,body:!0,title:!0},r={link:"head",base:"head"};t?t=t.ownerDocument||t.getOwnerDocument&&t.getOwnerDocument()||t:"undefined"!=typeof DOMDocument?t=new DOMDocument:"undefined"!=typeof document&&document.implementation&&document.implementation.createDocument?t=document.implementation.createDocument("","",null):"undefined"!=typeof ActiveX&&(t=new ActiveXObject("Msxml.DOMDocument"));var a=[],o=t.documentElement||t.getDocumentElement&&t.getDocumentElement();if(!o&&t.createElement&&!function(){var e=t.createElement("html"),n=t.createElement("head");n.appendChild(t.createElement("title")),e.appendChild(n),e.appendChild(t.createElement("body")),t.appendChild(e)}(),t.getElementsByTagName)for(var i in n)n[i]=t.getElementsByTagName(i)[0];var s=n.body;return new HTMLParser(e,{start:function(e,o,i){if(n[e])return void(s=n[e]);var c=t.createElement(e);for(var u in o)c.setAttribute(o[u].name,o[u].value);r[e]&&"boolean"!=typeof n[r[e]]?n[r[e]].appendChild(c):s&&s.appendChild&&s.appendChild(c),i||(a.push(c),s=c)},end:function(){a.length-=1,s=a[a.length-1]},chars:function(e){s.appendChild(t.createTextNode(e))},comment:function(){},ignore:function(){}}),t};