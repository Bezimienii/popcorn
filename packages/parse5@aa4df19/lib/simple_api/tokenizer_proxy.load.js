montageDefine("aa4df19","lib/simple_api/tokenizer_proxy",{dependencies:["../tokenization/tokenizer","../common/foreign_content","../common/unicode","../common/html"],factory:function(e,t,n){"use strict";var a=e("../tokenization/tokenizer"),i=e("../common/foreign_content"),o=e("../common/unicode"),s=e("../common/html"),r=s.TAG_NAMES,T=s.NAMESPACES,c=n.exports=function(e){this.tokenizer=new a(e),this.namespaceStack=[],this.namespaceStackTop=-1,this.currentNamespace=null,this.inForeignContent=!1};c.prototype.getNextToken=function(){var e=this.tokenizer.getNextToken();return e.type===a.START_TAG_TOKEN?this._handleStartTagToken(e):e.type===a.END_TAG_TOKEN?this._handleEndTagToken(e):e.type===a.NULL_CHARACTER_TOKEN&&this.inForeignContent&&(e.type=a.CHARACTER_TOKEN,e.chars=o.REPLACEMENT_CHARACTER),e},c.prototype._enterNamespace=function(e){this.namespaceStackTop++,this.namespaceStack.push(e),this.inForeignContent=e!==T.HTML,this.currentNamespace=e,this.tokenizer.allowCDATA=this.inForeignContent},c.prototype._leaveCurrentNamespace=function(){this.namespaceStackTop--,this.namespaceStack.pop(),this.currentNamespace=this.namespaceStack[this.namespaceStackTop],this.inForeignContent=this.currentNamespace!==T.HTML,this.tokenizer.allowCDATA=this.inForeignContent},c.prototype._ensureTokenizerState=function(e){e===r.TEXTAREA||e===r.TITLE?this.tokenizer.state=a.RCDATA_STATE:e===r.PLAINTEXT?this.tokenizer.state=a.PLAINTEXT_STATE:e===r.SCRIPT?this.tokenizer.state=a.SCRIPT_DATA_STATE:e!==r.STYLE&&e!==r.IFRAME&&e!==r.XMP&&e!==r.NOEMBED&&e!==r.NOFRAMES&&e!==r.NOSCRIPT||(this.tokenizer.state=a.RAWTEXT_STATE)},c.prototype._handleStartTagToken=function(e){var t=e.tagName;t===r.SVG?this._enterNamespace(T.SVG):t===r.MATH?this._enterNamespace(T.MATHML):this.inForeignContent?i.causesExit(e)?this._leaveCurrentNamespace():(i.isMathMLTextIntegrationPoint(t,this.currentNamespace)||i.isHtmlIntegrationPoint(t,this.currentNamespace,e.attrs))&&this._enterNamespace(T.HTML):this._ensureTokenizerState(t)},c.prototype._handleEndTagToken=function(e){var t=e.tagName;if(this.inForeignContent)(t===r.SVG&&this.currentNamespace===T.SVG||t===r.MATH&&this.currentNamespace===T.MATHML)&&this._leaveCurrentNamespace();else{var n=this.namespaceStack[this.namespaceStackTop-1];i.isMathMLTextIntegrationPoint(t,n)||i.isHtmlIntegrationPoint(t,n,e.attrs)?this._leaveCurrentNamespace():t===r.SCRIPT&&(this.tokenizer.state=a.DATA_STATE)}}}});