"use strict";function escapeString(e,t){return e=e.replace(AMP_REGEX,"&amp;").replace(NBSP_REGEX,"&nbsp;"),e=t?e.replace(DOUBLE_QUOTE_REGEX,"&quot;"):e.replace(LT_REGEX,"&lt;").replace(GT_REGEX,"&gt;")}function enquoteDoctypeId(e){var t=e.indexOf('"')!==-1?"'":'"';return t+e+t}var DefaultTreeAdapter=require("../tree_adapters/default"),HTML=require("../common/html"),$=HTML.TAG_NAMES,NS=HTML.NAMESPACES,AMP_REGEX=/&/g,NBSP_REGEX=/\u00a0/g,DOUBLE_QUOTE_REGEX=/"/g,LT_REGEX=/</g,GT_REGEX=/>/g,TreeSerializer=module.exports=function(e){this.treeAdapter=e||DefaultTreeAdapter};TreeSerializer.prototype.serialize=function(e){return this.html="",this._serializeChildNodes(e),this.html},TreeSerializer.prototype._serializeChildNodes=function(e){var t=this.treeAdapter.getChildNodes(e);if(t)for(var i=0,r=t.length;i<r;i++){var a=t[i];this.treeAdapter.isElementNode(a)?this._serializeElement(a):this.treeAdapter.isTextNode(a)?this._serializeTextNode(a):this.treeAdapter.isCommentNode(a)?this._serializeCommentNode(a):this.treeAdapter.isDocumentTypeNode(a)&&this._serializeDocumentTypeNode(a)}},TreeSerializer.prototype._serializeElement=function(e){var t=this.treeAdapter.getTagName(e),i=this.treeAdapter.getNamespaceURI(e),r=i===NS.HTML||i===NS.SVG||i===NS.MATHML?t:i+":"+t;if(this.html+="<"+r,this._serializeAttributes(e),this.html+=">",t!==$.AREA&&t!==$.BASE&&t!==$.BASEFONT&&t!==$.BGSOUND&&t!==$.BR&&t!==$.BR&&t!==$.COL&&t!==$.EMBED&&t!==$.FRAME&&t!==$.HR&&t!==$.IMG&&t!==$.INPUT&&t!==$.KEYGEN&&t!==$.LINK&&t!==$.MENUITEM&&t!==$.META&&t!==$.PARAM&&t!==$.SOURCE&&t!==$.TRACK&&t!==$.WBR){if(t===$.PRE||t===$.TEXTAREA||t===$.LISTING){var a=this.treeAdapter.getFirstChild(e);if(a&&this.treeAdapter.isTextNode(a)){var s=this.treeAdapter.getTextNodeContent(a);"\n"===s[0]&&(this.html+="\n")}}this._serializeChildNodes(e),this.html+="</"+r+">"}},TreeSerializer.prototype._serializeAttributes=function(e){for(var t=this.treeAdapter.getAttrList(e),i=0,r=t.length;i<r;i++){var a=t[i];this.html+=" ",a.namespace?a.namespace===NS.XML?this.html+="xml:"+a.name:a.namespace===NS.XMLNS?("xmlns"!==a.name&&(this.html+="xmlns:"),this.html+=a.name):a.namespace===NS.XLINK?this.html+="xlink:"+a.name:this.html+=a.namespace+":"+a.name:this.html+=a.name,this.html+='="'+escapeString(a.value,!0)+'"'}},TreeSerializer.prototype._serializeTextNode=function(e){var t=this.treeAdapter.getParentNode(e),i=t&&this.treeAdapter.getTagName(t),r=this.treeAdapter.getTextNodeContent(e);i===$.STYLE||i===$.SCRIPT||i===$.XMP||i===$.IFRAME||i===$.NOEMBED||i===$.NOFRAMES||i===$.PLAINTEXT||i===$.NOSCRIPT?this.html+=r:this.html+=escapeString(r,!1)},TreeSerializer.prototype._serializeCommentNode=function(e){this.html+="<!--"+this.treeAdapter.getCommentNodeContent(e)+"-->"},TreeSerializer.prototype._serializeDocumentTypeNode=function(e){var t=this.treeAdapter.getDocumentTypeNodeName(e),i=this.treeAdapter.getDocumentTypeNodePublicId(e),r=this.treeAdapter.getDocumentTypeNodeSystemId(e);this.html+="<!DOCTYPE "+t,null!==i?this.html+=" PUBLIC "+enquoteDoctypeId(i):null!==r&&(this.html+=" SYSTEM"),null!==r&&(this.html+=" "+enquoteDoctypeId(r)),this.html+=">"};