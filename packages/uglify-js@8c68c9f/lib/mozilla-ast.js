"use strict";!function(){function e(e){if("Literal"==e.type)return null!=e.raw?e.raw:e.value+""}function t(t){var n=t.loc,r=n&&n.start,a=t.range;return new AST_Token({file:n&&n.source,line:r&&r.line,col:r&&r.column,pos:a?a[0]:t.start,endline:r&&r.line,endcol:r&&r.column,endpos:a?a[0]:t.start,raw:e(t)})}function n(t){var n=t.loc,r=n&&n.end,a=t.range;return new AST_Token({file:n&&n.source,line:r&&r.line,col:r&&r.column,pos:a?a[1]:t.end,endline:r&&r.line,endcol:r&&r.column,endpos:a?a[1]:t.end,raw:e(t)})}function r(e,r,o){var p="function From_Moz_"+e+"(M){\n";p+="return new U2."+r.name+"({\nstart: my_start_token(M),\nend: my_end_token(M)";var c="function To_Moz_"+e+"(M){\n";c+="return {\ntype: "+JSON.stringify(e),o&&o.split(/\s*,\s*/).forEach(function(e){var t=/([a-z0-9$_]+)(=|@|>|%)([a-z0-9$_]+)/i.exec(e);if(!t)throw new Error("Can't understand property map: "+e);var n=t[1],r=t[2],a=t[3];switch(p+=",\n"+a+": ",c+=",\n"+n+": ",r){case"@":p+="M."+n+".map(from_moz)",c+="M."+a+".map(to_moz)";break;case">":p+="from_moz(M."+n+")",c+="to_moz(M."+a+")";break;case"=":p+="M."+n,c+="M."+a;break;case"%":p+="from_moz(M."+n+").body",c+="to_moz_block(M)";break;default:throw new Error("Can't understand operator in propmap: "+e)}}),p+="\n})\n}",c+="\n}\n}",p=new Function("U2","my_start_token","my_end_token","from_moz","return("+p+")")(exports,t,n,a),c=new Function("to_moz","to_moz_block","return("+c+")")(l,s),u[e]=p,i(r,c)}function a(e){p.push(e);var t=null!=e?u[e.type](e):null;return p.pop(),t}function o(e,t,n){var r=e.start,a=e.end;return null!=r.pos&&null!=a.endpos&&(t.range=[r.pos,a.endpos]),r.line&&(t.loc={start:{line:r.line,column:r.col},end:a.endline?{line:a.endline,column:a.endcol}:null},r.file&&(t.loc.source=r.file)),t}function i(e,t){e.DEFMETHOD("to_mozilla_ast",function(){return o(this,t(this))})}function l(e){return null!=e?e.to_mozilla_ast():null}function s(e){return{type:"BlockStatement",body:e.body.map(l)}}var u={ExpressionStatement:function(e){var r=e.expression;return"Literal"===r.type&&"string"==typeof r.value?new AST_Directive({start:t(e),end:n(e),value:r.value}):new AST_SimpleStatement({start:t(e),end:n(e),body:a(r)})},TryStatement:function(e){var r=e.handlers||[e.handler];if(r.length>1||e.guardedHandlers&&e.guardedHandlers.length)throw new Error("Multiple catch clauses are not supported.");return new AST_Try({start:t(e),end:n(e),body:a(e.block).body,bcatch:a(r[0]),bfinally:e.finalizer?new AST_Finally(a(e.finalizer)):null})},Property:function(e){var r=e.key,o="Identifier"==r.type?r.name:r.value,i={start:t(r),end:n(e.value),key:o,value:a(e.value)};switch(e.kind){case"init":return new AST_ObjectKeyVal(i);case"set":return i.value.name=a(r),new AST_ObjectSetter(i);case"get":return i.value.name=a(r),new AST_ObjectGetter(i)}},ObjectExpression:function(e){return new AST_Object({start:t(e),end:n(e),properties:e.properties.map(function(e){return e.type="Property",a(e)})})},SequenceExpression:function(e){return AST_Seq.from_array(e.expressions.map(a))},MemberExpression:function(e){return new(e.computed?AST_Sub:AST_Dot)({start:t(e),end:n(e),property:e.computed?a(e.property):e.property.name,expression:a(e.object)})},SwitchCase:function(e){return new(e.test?AST_Case:AST_Default)({start:t(e),end:n(e),expression:a(e.test),body:e.consequent.map(a)})},VariableDeclaration:function(e){return new("const"===e.kind?AST_Const:AST_Var)({start:t(e),end:n(e),definitions:e.declarations.map(a)})},Literal:function(e){var r=e.value,a={start:t(e),end:n(e)};if(null===r)return new AST_Null(a);switch(typeof r){case"string":return a.value=r,new AST_String(a);case"number":return a.value=r,new AST_Number(a);case"boolean":return new(r?AST_True:AST_False)(a);default:var o=e.regex;return o&&o.pattern?a.value=new RegExp(o.pattern,o.flags).toString():a.value=e.regex&&e.raw?e.raw:r,new AST_RegExp(a)}},Identifier:function(e){var r=p[p.length-2];return new("LabeledStatement"==r.type?AST_Label:"VariableDeclarator"==r.type&&r.id===e?"const"==r.kind?AST_SymbolConst:AST_SymbolVar:"FunctionExpression"==r.type?r.id===e?AST_SymbolLambda:AST_SymbolFunarg:"FunctionDeclaration"==r.type?r.id===e?AST_SymbolDefun:AST_SymbolFunarg:"CatchClause"==r.type?AST_SymbolCatch:"BreakStatement"==r.type||"ContinueStatement"==r.type?AST_LabelRef:AST_SymbolRef)({start:t(e),end:n(e),name:e.name})}};u.UpdateExpression=u.UnaryExpression=function(e){var r="prefix"in e?e.prefix:"UnaryExpression"==e.type;return new(r?AST_UnaryPrefix:AST_UnaryPostfix)({start:t(e),end:n(e),operator:e.operator,expression:a(e.argument)})},r("Program",AST_Toplevel,"body@body"),r("EmptyStatement",AST_EmptyStatement),r("BlockStatement",AST_BlockStatement,"body@body"),r("IfStatement",AST_If,"test>condition, consequent>body, alternate>alternative"),r("LabeledStatement",AST_LabeledStatement,"label>label, body>body"),r("BreakStatement",AST_Break,"label>label"),r("ContinueStatement",AST_Continue,"label>label"),r("WithStatement",AST_With,"object>expression, body>body"),r("SwitchStatement",AST_Switch,"discriminant>expression, cases@body"),r("ReturnStatement",AST_Return,"argument>value"),r("ThrowStatement",AST_Throw,"argument>value"),r("WhileStatement",AST_While,"test>condition, body>body"),r("DoWhileStatement",AST_Do,"test>condition, body>body"),r("ForStatement",AST_For,"init>init, test>condition, update>step, body>body"),r("ForInStatement",AST_ForIn,"left>init, right>object, body>body"),r("DebuggerStatement",AST_Debugger),r("FunctionDeclaration",AST_Defun,"id>name, params@argnames, body%body"),r("VariableDeclarator",AST_VarDef,"id>name, init>value"),r("CatchClause",AST_Catch,"param>argname, body%body"),r("ThisExpression",AST_This),r("ArrayExpression",AST_Array,"elements@elements"),r("FunctionExpression",AST_Function,"id>name, params@argnames, body%body"),r("BinaryExpression",AST_Binary,"operator=operator, left>left, right>right"),r("LogicalExpression",AST_Binary,"operator=operator, left>left, right>right"),r("AssignmentExpression",AST_Assign,"operator=operator, left>left, right>right"),r("ConditionalExpression",AST_Conditional,"test>condition, consequent>consequent, alternate>alternative"),r("NewExpression",AST_New,"callee>expression, arguments@args"),r("CallExpression",AST_Call,"callee>expression, arguments@args"),i(AST_Directive,function(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e.value}}}),i(AST_SimpleStatement,function(e){return{type:"ExpressionStatement",expression:l(e.body)}}),i(AST_SwitchBranch,function(e){return{type:"SwitchCase",test:l(e.expression),consequent:e.body.map(l)}}),i(AST_Try,function(e){return{type:"TryStatement",block:s(e),handler:l(e.bcatch),guardedHandlers:[],finalizer:l(e.bfinally)}}),i(AST_Catch,function(e){return{type:"CatchClause",param:l(e.argname),guard:null,body:s(e)}}),i(AST_Definitions,function(e){return{type:"VariableDeclaration",kind:e instanceof AST_Const?"const":"var",declarations:e.definitions.map(l)}}),i(AST_Seq,function(e){return{type:"SequenceExpression",expressions:e.to_array().map(l)}}),i(AST_PropAccess,function(e){var t=e instanceof AST_Sub;return{type:"MemberExpression",object:l(e.expression),computed:t,property:t?l(e.property):{type:"Identifier",name:e.property}}}),i(AST_Unary,function(e){return{type:"++"==e.operator||"--"==e.operator?"UpdateExpression":"UnaryExpression",operator:e.operator,prefix:e instanceof AST_UnaryPrefix,argument:l(e.expression)}}),i(AST_Binary,function(e){return{type:"&&"==e.operator||"||"==e.operator?"LogicalExpression":"BinaryExpression",left:l(e.left),operator:e.operator,right:l(e.right)}}),i(AST_Object,function(e){return{type:"ObjectExpression",properties:e.properties.map(l)}}),i(AST_ObjectProperty,function(e){var t,n=is_identifier(e.key)?{type:"Identifier",name:e.key}:{type:"Literal",value:e.key};return e instanceof AST_ObjectKeyVal?t="init":e instanceof AST_ObjectGetter?t="get":e instanceof AST_ObjectSetter&&(t="set"),{type:"Property",kind:t,key:n,value:l(e.value)}}),i(AST_Symbol,function(e){var t=e.definition();return{type:"Identifier",name:t?t.mangled_name||t.name:e.name}}),i(AST_RegExp,function(e){var t=e.value;return{type:"Literal",value:t,raw:t.toString(),regex:{pattern:t.source,flags:t.toString().match(/[gimuy]*$/)[0]}}}),i(AST_Constant,function(e){var t=e.value;return"number"==typeof t&&(t<0||0===t&&1/t<0)?{type:"UnaryExpression",operator:"-",prefix:!0,argument:{type:"Literal",value:-t,raw:e.start.raw}}:{type:"Literal",value:t,raw:e.start.raw}}),i(AST_Atom,function(e){return{type:"Identifier",name:String(e.value)}}),AST_Boolean.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast),AST_Null.DEFMETHOD("to_mozilla_ast",AST_Constant.prototype.to_mozilla_ast),AST_Hole.DEFMETHOD("to_mozilla_ast",function(){return null}),AST_Block.DEFMETHOD("to_mozilla_ast",AST_BlockStatement.prototype.to_mozilla_ast),AST_Lambda.DEFMETHOD("to_mozilla_ast",AST_Function.prototype.to_mozilla_ast);var p=null;AST_Node.from_mozilla_ast=function(e){var t=p;p=[];var n=a(e);return p=t,n}}();